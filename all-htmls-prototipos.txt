<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Localizações - CMMS Pro</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            overflow: hidden; /* Prevent body scroll */
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .main-layout {
            display: grid;
            grid-template-columns: 40% 60%;
            gap: 1.5rem;
            height: calc(100vh - 56px - 2rem); /* Full height minus navbar and padding */
        }
        .location-list-card, .map-view-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .map-container {
            position: relative;
            cursor: pointer;
            overflow: hidden;
            border-radius: 0.5rem;
            background-color: #e9ecef;
        }
        .map-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .location-pin {
            position: absolute;
            width: 24px;
            height: 24px;
            background-color: rgba(13, 110, 253, 0.9);
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .location-pin:hover {
            transform: translate(-50%, -50%) scale(1.3);
        }
        .location-pin.selected {
             transform: translate(-50%, -50%) scale(1.6);
             background-color: #ffc107;
             z-index: 10;
        }
        .list-group-item {
            cursor: pointer;
        }
        .popover-header {
            font-weight: 600;
        }
        .asset-list-popover {
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .asset-list-popover li {
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <div class="collapse navbar-collapse" id="main-nav">
                 <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="asset_management_list.html">Ativos</a></li>
                    <li class="nav-item"><a class="nav-link" href="inventory_management.html">Inventário</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" id="adminMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Administração
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="adminMenu">
                            <li><a class="dropdown-item" href="user_management.html">Gestão de Usuários</a></li>
                            <li><a class="dropdown-item active" href="location_management.html">Gestão de Localizações</a></li>
                            <li><a class="dropdown-item" href="qrcode_generator.html">Gerador de QR Code</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Admin)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container-fluid p-3">
        <div class="main-layout">
            <!-- Coluna da Lista de Localizações -->
            <div class="location-list-card">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Localizações por Mapa</h5>
                        <div>
                            <button class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#mapManagementModal"><i class="bi bi-map me-1"></i> Gerenciar Mapas</button>
                            <button class="btn btn-primary btn-sm" id="btn-new-location"><i class="bi bi-plus-circle-fill me-1"></i> Nova</button>
                        </div>
                    </div>
                    <div class="card-body flex-grow-1" style="overflow-y: auto;">
                        <div class="accordion" id="mapAccordion">
                           <!-- Accordions serão inseridos aqui via JS -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Coluna do Mapa -->
            <div class="map-view-card">
                 <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0" id="map-title">Selecione uma localização para ver o mapa</h5>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                         <div class="map-container w-100 h-100" id="map-container">
                             <img src="https://placehold.co/1000x700/e9ecef/adb5bd?text=Mapa+Aparecerá+Aqui" id="map-image" class="img-fluid">
                         </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals (Add/Edit Location, Manage Maps, Delete, Add/Move Asset) -->
    <!-- ... (Todos os modals foram movidos para o final para melhor organização) ... -->
    
    <!-- Modal: Adicionar/Editar Localização -->
    <div class="modal fade" id="locationModal" tabindex="-1">
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="locationModalLabel">Nova Localização</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row">
                <div class="col-md-4">
                    <form id="location-form">
                      <input type="hidden" id="locationId">
                      <div class="mb-3">
                        <label for="locationName" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="locationName" required>
                      </div>
                      <div class="mb-3">
                        <label for="locationDescription" class="form-label">Descrição</label>
                        <textarea class="form-control" id="locationDescription" rows="3"></textarea>
                      </div>
                      <div class="mb-3">
                        <label for="locationMap" class="form-label">Mapa</label>
                        <select class="form-select" id="locationMap" required>
                          <!-- Options loaded by JS -->
                        </select>
                      </div>
                      <div class="row">
                          <div class="col-6"><label for="coordX" class="form-label">Coord. X</label><input type="number" class="form-control" id="coordX" readonly></div>
                          <div class="col-6"><label for="coordY" class="form-label">Coord. Y</label><input type="number" class="form-control" id="coordY" readonly></div>
                      </div>
                    </form>
                </div>
                <div class="col-md-8">
                     <label class="form-label">Clique no mapa para definir a posição</label>
                     <div class="map-container" id="modal-map-container" style="height: 400px; cursor: crosshair;">
                        <img src="https://placehold.co/1000x700/e9ecef/adb5bd?text=Selecione+um+mapa" id="modal-map-image" class="img-fluid">
                     </div>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary" form="location-form">Salvar</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal: Gerenciar Mapas -->
    <div class="modal fade" id="mapManagementModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Gerenciar Mapas</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <h6>Mapas Existentes</h6>
                    <ul class="list-group mb-4" id="maps-list-modal"></ul>
                    <h6>Adicionar Novo Mapa</h6>
                    <form id="map-form">
                        <div class="mb-3"><label for="mapName" class="form-label">Nome do Mapa</label><input type="text" class="form-control" id="mapName" required></div>
                        <div class="mb-3"><label for="mapImage" class="form-label">Imagem (PNG/JPG)</label><input class="form-control" type="file" id="mapImage" accept="image/png, image/jpeg" required></div>
                         <button type="submit" class="btn btn-success">Salvar Novo Mapa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal: Confirmação de Exclusão -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content">
        <div class="modal-header bg-danger text-white"><h5 class="modal-title">Confirmar Exclusão</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <p>Você tem certeza que deseja excluir a localização <strong id="location-name-to-delete"></strong>?</p>
            <p class="text-danger">Atenção: Esta ação não pode ser desfeita.</p>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="button" class="btn btn-danger" id="confirmDeleteBtn">Sim, Excluir</button></div>
    </div></div></div>

    <!-- Modal: Adicionar Ativo -->
    <div class="modal fade" id="addAssetModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Adicionar Ativo em <strong id="add-asset-location-name"></strong></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="add-asset-form">
                <div class="mb-3"><label for="assetName" class="form-label">Nome do Ativo</label><input type="text" class="form-control" id="assetName" required></div>
                <div class="mb-3"><label for="assetTag" class="form-label">Tag do Ativo</label><input type="text" class="form-control" id="assetTag" required></div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-primary" form="add-asset-form">Adicionar Ativo</button></div>
    </div></div></div>

    <!-- Modal: Mover Ativo -->
    <div class="modal fade" id="moveAssetModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Mover Ativo de <strong id="move-asset-source-name"></strong></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="move-asset-form">
                <div class="mb-3"><label class="form-label">Selecione o Ativo para Mover</label><select class="form-select" id="asset-to-move" required></select></div>
                <div class="mb-3"><label class="form-label">Selecione o Novo Local</label><select class="form-select" id="asset-target-location" required></select></div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-primary" form="move-asset-form">Mover Ativo</button></div>
    </div></div></div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        // Simulação de Banco de Dados
        let db = {
            maps: [
                { id: 1, name: 'Térreo', src: 'https://placehold.co/1000x700/ffffff/000000?text=Planta+Térreo' },
                { id: 2, name: 'Subsolo', src: 'https://placehold.co/1000x700/cccccc/000000?text=Planta+Subsolo' }
            ],
            locations: [
                { id: 1, name: 'Ala Norte - Produção', description: 'Área de montagem principal.', mapId: 1, x: 250, y: 300, assetCount: 12 },
                { id: 2, name: 'Prédio A, Sala 101', description: 'Sala de compressores.', mapId: 1, x: 700, y: 500, assetCount: 5 },
                { id: 3, name: 'Almoxarifado', description: 'Estoque de peças.', mapId: 2, x: 400, y: 150, assetCount: 3 },
            ],
            assets: [
                { id: 101, name: 'Compressor C-101', locationId: 2 },
                { id: 102, name: 'Prensa P-05', locationId: 1 },
                { id: 103, name: 'Esteira E-22', locationId: 1 },
            ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Instâncias dos Modals
            const locationModal = new bootstrap.Modal(document.getElementById('locationModal'));
            const deleteConfirmModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            const addAssetModal = new bootstrap.Modal(document.getElementById('addAssetModal'));
            const moveAssetModal = new bootstrap.Modal(document.getElementById('moveAssetModal'));
            
            // Elementos do DOM
            const mainMapImage = document.getElementById('map-image');
            const mainMapContainer = document.getElementById('map-container');
            const mapTitle = document.getElementById('map-title');
            const mapAccordion = document.getElementById('mapAccordion');
            let currentPopover = null;

            // --- FUNÇÕES DE RENDERIZAÇÃO ---
            function renderAccordion() {
                mapAccordion.innerHTML = '';
                db.maps.forEach((map, index) => {
                    const locationsInMap = db.locations.filter(loc => loc.mapId === map.id);
                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'accordion-item';
                    accordionItem.innerHTML = `
                        <h2 class="accordion-header" id="heading-${map.id}">
                            <button class="accordion-button ${index > 0 ? 'collapsed' : ''}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${map.id}">
                                ${map.name}
                            </button>
                        </h2>
                        <div id="collapse-${map.id}" class="accordion-collapse collapse ${index === 0 ? 'show' : ''}" data-bs-parent="#mapAccordion">
                            <div class="list-group list-group-flush">
                                ${locationsInMap.length > 0 ? locationsInMap.map(loc => `
                                    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center location-item" data-location-id="${loc.id}">
                                        <div>
                                            <div class="fw-bold">${loc.name}</div>
                                            <small class="text-muted">Ativos: ${loc.assetCount}</small>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-outline-secondary btn-edit" title="Editar"><i class="bi bi-pencil-fill"></i></button>
                                            <button class="btn btn-sm btn-outline-danger btn-delete" title="Excluir"><i class="bi bi-trash-fill"></i></button>
                                        </div>
                                    </div>
                                `).join('') : '<div class="list-group-item text-muted">Nenhuma localização neste mapa.</div>'}
                            </div>
                        </div>`;
                    mapAccordion.appendChild(accordionItem);
                });
            }

            function renderPins(mapId) {
                mainMapContainer.querySelectorAll('.location-pin').forEach(pin => pin.remove());
                db.locations.filter(loc => loc.mapId === mapId).forEach(loc => {
                    const pin = document.createElement('div');
                    pin.className = 'location-pin';
                    pin.style.left = `${(loc.x / 1000) * 100}%`;
                    pin.style.top = `${(loc.y / 700) * 100}%`;
                    pin.dataset.locationId = loc.id;
                    mainMapContainer.appendChild(pin);
                });
            }
            
            function showMap(mapId) {
                const map = db.maps.find(m => m.id === mapId);
                if (map) {
                    mainMapImage.src = map.src;
                    mapTitle.textContent = `Mapa: ${map.name}`;
                    renderPins(mapId);
                }
            }

            // --- LÓGICA DOS MODALS ---
            
            // Modal de Localização (Criar/Editar)
            function openLocationModal(locationId = null) {
                const form = document.getElementById('location-form');
                form.reset();
                document.getElementById('locationModalLabel').textContent = locationId ? 'Editar Localização' : 'Nova Localização';
                document.getElementById('locationId').value = locationId || '';

                const mapSelect = document.getElementById('locationMap');
                mapSelect.innerHTML = '<option value="" disabled selected>Selecione um mapa...</option>' 
                    + db.maps.map(m => `<option value="${m.id}" data-img-src="${m.src}">${m.name}</option>`).join('');

                const modalMapContainer = document.getElementById('modal-map-container');
                modalMapContainer.innerHTML = `<img src="https://placehold.co/1000x700/e9ecef/adb5bd?text=Selecione+um+mapa" id="modal-map-image" class="img-fluid">`; // Reset map

                if(locationId) {
                    const loc = db.locations.find(l => l.id === locationId);
                    document.getElementById('locationName').value = loc.name;
                    document.getElementById('locationDescription').value = loc.description;
                    mapSelect.value = loc.mapId;
                    mapSelect.dispatchEvent(new Event('change')); // Trigger map image change
                    document.getElementById('coordX').value = loc.x;
                    document.getElementById('coordY').value = loc.y;
                    
                    // Show existing pin
                    setTimeout(() => { // Timeout to allow map image to load
                        const pin = document.createElement('div');
                        pin.className = 'location-pin selected';
                        pin.style.left = `${(loc.x / 1000) * 100}%`;
                        pin.style.top = `${(loc.y / 700) * 100}%`;
                        modalMapContainer.appendChild(pin);
                    }, 200);
                }
                locationModal.show();
            }

            // --- EVENT LISTENERS ---

            // Clicar num item da lista
            mapAccordion.addEventListener('click', (e) => {
                const item = e.target.closest('.location-item');
                if (item) {
                    const locationId = parseInt(item.dataset.locationId);
                    const location = db.locations.find(l => l.id === locationId);
                    if (location) {
                        showMap(location.mapId);
                        setTimeout(() => { // Ensure pins are rendered
                            mainMapContainer.querySelectorAll('.location-pin').forEach(pin => {
                                pin.classList.toggle('selected', parseInt(pin.dataset.locationId) === locationId);
                            });
                        }, 50);
                    }
                }
                if (e.target.closest('.btn-edit')) {
                    openLocationModal(parseInt(item.dataset.locationId));
                }
                if (e.target.closest('.btn-delete')) {
                    const location = db.locations.find(l => l.id === parseInt(item.dataset.locationId));
                    document.getElementById('location-name-to-delete').textContent = location.name;
                    deleteConfirmModal.show();
                }
            });

            // Clicar num pino do mapa principal
            mainMapContainer.addEventListener('click', (e) => {
                if (currentPopover) {
                    currentPopover.dispose();
                    currentPopover = null;
                }
                const pin = e.target.closest('.location-pin');
                if (pin) {
                    const locationId = parseInt(pin.dataset.locationId);
                    const location = db.locations.find(l => l.id === locationId);
                    const assetsInLocation = db.assets.filter(a => a.locationId === locationId);

                    const popoverContent = document.createElement('div');
                    popoverContent.innerHTML = `
                        <ul class="asset-list-popover">
                            ${assetsInLocation.length > 0 ? assetsInLocation.map(a => `<li>${a.name}</li>`).join('') : '<li class="text-muted">Nenhum ativo aqui.</li>'}
                        </ul>
                        <hr class="my-2">
                        <div class="d-flex justify-content-around">
                            <button class="btn btn-sm btn-outline-primary btn-add-asset"><i class="bi bi-plus-circle"></i> Add</button>
                            <button class="btn btn-sm btn-outline-secondary btn-move-asset"><i class="bi bi-arrows-move"></i> Mover</button>
                        </div>
                    `;
                    
                    // Add listeners for popover buttons
                    popoverContent.querySelector('.btn-add-asset').addEventListener('click', () => {
                        document.getElementById('add-asset-location-name').textContent = location.name;
                        addAssetModal.show();
                        currentPopover.hide();
                    });
                    popoverContent.querySelector('.btn-move-asset').addEventListener('click', () => {
                         document.getElementById('move-asset-source-name').textContent = location.name;
                         // Populate selects for move asset modal
                         document.getElementById('asset-to-move').innerHTML = assetsInLocation.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
                         document.getElementById('asset-target-location').innerHTML = db.locations.filter(l => l.id !== locationId).map(l => `<option value="${l.id}">${l.name}</option>`).join('');
                         moveAssetModal.show();
                         currentPopover.hide();
                    });
                    
                    currentPopover = new bootstrap.Popover(pin, {
                        title: location.name,
                        content: popoverContent,
                        html: true,
                        placement: 'top'
                    });
                    currentPopover.show();
                }
            });

            // Botão "Nova Localização"
            document.getElementById('btn-new-location').addEventListener('click', () => openLocationModal());
            
            // Modal de Localização: lógica do mapa
            const modalMapContainer = document.getElementById('modal-map-container');
            document.getElementById('locationMap').addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                document.getElementById('modal-map-image').src = selectedOption.dataset.imgSrc || 'https://placehold.co/1000x700/e9ecef/adb5bd?text=Selecione+um+mapa';
            });
            modalMapContainer.addEventListener('click', function(e) {
                if(e.target.closest('.location-pin')) return; // Don't re-trigger on pin click
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const xCoord = Math.round((x / rect.width) * 1000);
                const yCoord = Math.round((y / rect.height) * 700);

                document.getElementById('coordX').value = xCoord;
                document.getElementById('coordY').value = yCoord;

                let pin = this.querySelector('.location-pin');
                if (!pin) {
                    pin = document.createElement('div');
                    pin.className = 'location-pin selected';
                    this.appendChild(pin);
                }
                pin.style.left = `${(x / rect.width) * 100}%`;
                pin.style.top = `${(y / rect.height) * 100}%`;
            });

            // Simulação de Submissão de Formulários
            document.getElementById('location-form').addEventListener('submit', (e) => { e.preventDefault(); locationModal.hide(); alert('Localização salva (simulado).'); });
            document.getElementById('map-form').addEventListener('submit', (e) => { e.preventDefault(); bootstrap.Modal.getInstance(document.getElementById('mapManagementModal')).hide(); alert('Mapa salvo (simulado).'); });
            document.getElementById('add-asset-form').addEventListener('submit', (e) => { e.preventDefault(); addAssetModal.hide(); alert('Ativo adicionado (simulado).'); });
            document.getElementById('move-asset-form').addEventListener('submit', (e) => { e.preventDefault(); moveAssetModal.hide(); alert('Ativo movido (simulado).'); });
            document.getElementById('confirmDeleteBtn').addEventListener('click', (e) => { e.preventDefault(); deleteConfirmModal.hide(); alert('Localização excluída (simulado).'); });


            // INICIALIZAÇÃO
            renderAccordion();
            if (db.locations.length > 0) {
                showMap(db.locations[0].mapId);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Tickets - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.025);
        }
        .nav-link.active {
            font-weight: 600;
        }
        .status-open { border-left: 4px solid #0d6efd; }
        .status-pending { border-left: 4px solid #ffc107; }
        .status-resolved { border-left: 4px solid #198754; }
        .status-closed { border-left: 4px solid #6c757d; opacity: 0.7; }
        .late-ticket { background-color: #fff3cd; }
        .late-ticket:hover { background-color: #ffeeba !important; }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="asset_management_list.html">Ativos</a></li>
                    <li class="nav-item"><a class="nav-link" href="inventory_management.html">Inventário</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">Gestão e Triagem de Tickets</h1>
            <a href="ticket_create.html" class="btn btn-primary">
                <i class="bi bi-plus-circle-fill me-2"></i>Criar Novo Ticket
            </a>
        </div>

        <!-- Filtros e Busca -->
        <div class="card mb-4">
            <div class="card-body">
                <form class="row g-3 align-items-end">
                    <div class="col-md-5">
                        <label for="search" class="form-label">Busca</label>
                        <input type="text" class="form-control" id="search" placeholder="Buscar por título ou ativo...">
                    </div>
                    <div class="col-md-3">
                        <label for="statusFilter" class="form-label">Status</label>
                        <select id="statusFilter" class="form-select">
                            <option selected>Todos</option>
                            <option value="open">Aberto</option>
                            <option value="pending">Pendente</option>
                            <option value="resolved">Resolvido</option>
                            <option value="closed">Fechado</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="requesterFilter" class="form-label">Solicitante</label>
                         <select id="requesterFilter" class="form-select">
                            <option selected>Todos</option>
                            <option>Carlos Pereira</option>
                            <option>Roberto Andrade</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-secondary w-100"><i class="bi bi-filter me-2"></i>Filtrar</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Tabela de Tickets -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Título e Status</th>
                                <th>Ativo</th>
                                <th>Solicitante</th>
                                <th>Data Abertura</th>
                                <th class="text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ticket para criar OS -->
                            <tr class="status-open late-ticket">
                                <td>
                                    <div class="fw-bold">Painel da IHM não responde</div>
                                    <span class="badge bg-primary">Aberto</span>
                                </td>
                                <td>Prensa Hidráulica P-05</td>
                                <td>Carlos Pereira</td>
                                <td>10/10/2025 <span class="badge bg-danger">7 dias</span></td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#triageModal">Analisar Ticket</button>
                                </td>
                            </tr>
                            <!-- Ticket para Resolver -->
                            <tr class="status-pending">
                                <td>
                                    <div class="fw-bold">Verificar vazamento no sistema hidráulico</div>
                                    <span class="badge bg-warning text-dark">Pendente</span>
                                </td>
                                <td>Bomba Hidráulica B-52</td>
                                <td>Roberto Andrade</td>
                                <td>15/10/2025</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#triageModal">Analisar Ticket</button>
                                </td>
                            </tr>
                            <!-- Ticket para Fechar -->
                            <tr class="status-resolved">
                                <td>
                                    <div class="fw-bold">Compressor com ruído estranho</div>
                                    <span class="badge bg-success">Resolvido</span>
                                </td>
                                <td>Compressor de Ar C-101</td>
                                <td>Lúcia Martins</td>
                                <td>14/10/2025</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#triageModal">Analisar Ticket</button>
                                </td>
                            </tr>
                            <!-- Ticket Fechado -->
                             <tr class="status-closed">
                                <td>
                                    <div class="fw-bold">Luz de emergência queimada</div>
                                    <span class="badge bg-secondary">Fechado</span>
                                </td>
                                <td>Painel Elétrico PE-03</td>
                                <td>Carlos Pereira</td>
                                <td>05/10/2025</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#triageModal">Ver Histórico</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Triagem de Ticket -->
    <div class="modal fade" id="triageModal" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Análise do Ticket: <span id="triage-ticket-title" class="fw-bold">Painel da IHM não responde</span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <h6>Detalhes da Solicitação</h6>
            <p><strong>Solicitante:</strong> Carlos Pereira</p>
            <p><strong>Ativo:</strong> Prensa Hidráulica P-05</p>
            <p><strong>Descrição:</strong> O painel da IHM (Interface Homem-Máquina) está travado e não responde aos comandos de toque. A produção está parada.</p>
            <hr>
            <h6>Situação Atual</h6>
            <p><strong>Status do Ticket:</strong> <span class="badge bg-primary">Aberto</span></p>
            <p><strong>Ordem de Serviço Vinculada:</strong> Nenhuma OS criada ainda.</p>
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <!-- Ações Contextuais -->
            <div>
                 <button type="button" class="btn btn-success"><i class="bi bi-wrench-adjustable-circle me-1"></i>Criar Ordem de Serviço</button>
                 <!-- Exemplo de como outros botões apareceriam: -->
                 <!-- <button type="button" class="btn btn-info d-none">Resolver Ticket</button> -->
                 <!-- <button type="button" class="btn btn-dark d-none">Fechar Ticket</button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios Gerenciais - CMMS Pro</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns/"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
            height: 100%;
        }
        .nav-link.active {
            font-weight: 600;
        }
        .nav-tabs .nav-link {
            color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
        }
        .kpi-card .card-body {
            display: flex;
            align-items: center;
        }
        .kpi-card .icon-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
        }
        .chart-container {
            height: 350px;
        }
        .info-icon {
            cursor: pointer;
            color: #6c757d;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="reports.html">Relatórios</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">Relatórios Gerenciais e KPIs</h1>
            <div class="col-md-3">
                <select id="periodFilter" class="form-select">
                    <option value="30">Últimos 30 dias</option>
                    <option value="90">Últimos 90 dias</option>
                    <option value="this_month">Este Mês</option>
                    <option value="this_year">Este Ano</option>
                </select>
            </div>
        </div>

        <!-- Abas de Navegação -->
        <ul class="nav nav-tabs mb-4" id="reportsTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview-pane" type="button" role="tab">Visão Geral</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="assets-tab" data-bs-toggle="tab" data-bs-target="#assets-pane" type="button" role="tab">Análise de Ativos</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="team-tab" data-bs-toggle="tab" data-bs-target="#team-pane" type="button" role="tab">Performance da Equipe</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced-pane" type="button" role="tab">Análises Avançadas</button>
            </li>
        </ul>

        <!-- Conteúdo das Abas -->
        <div class="tab-content" id="reportsTabContent">
            <!-- Aba Visão Geral -->
            <div class="tab-pane fade show active" id="overview-pane" role="tabpanel">
                 <div class="row mb-4">
                    <div class="col-lg-3 col-md-6 mb-3"><div class="card kpi-card"><div class="card-body"><div class="icon-circle bg-primary text-white"><i class="bi bi-clock-history"></i></div><div><h6 class="card-subtitle text-muted">MTTR <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Tempo Médio Para Reparo: Tempo médio desde a abertura da OS até sua conclusão."></i></h6><h4 class="card-title fw-bold mb-0">4.2 horas</h4></div></div></div></div>
                    <div class="col-lg-3 col-md-6 mb-3"><div class="card kpi-card"><div class="card-body"><div class="icon-circle bg-success text-white"><i class="bi bi-shield-check"></i></div><div><h6 class="card-subtitle text-muted">MTBF <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Tempo Médio Entre Falhas: Tempo médio que um ativo opera antes de falhar."></i></h6><h4 class="card-title fw-bold mb-0">120 dias</h4></div></div></div></div>
                    <div class="col-lg-3 col-md-6 mb-3"><div class="card kpi-card"><div class="card-body"><div class="icon-circle bg-info text-white"><i class="bi bi-calendar-check"></i></div><div><h6 class="card-subtitle text-muted">PM Compliance <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Aderência às Preventivas: Percentual de manutenções preventivas concluídas no prazo."></i></h6><h4 class="card-title fw-bold mb-0">92%</h4></div></div></div></div>
                    <div class="col-lg-3 col-md-6 mb-3"><div class="card kpi-card"><div class="card-body"><div class="icon-circle bg-warning text-dark"><i class="bi bi-tools"></i></div><div><h6 class="card-subtitle text-muted">OS Concluídas <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Total de Ordens de Serviço concluídas no período selecionado."></i></h6><h4 class="card-title fw-bold mb-0">142</h4></div></div></div></div>
                </div>
                <div class="row">
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">OS por Status</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Distribuição de todas as OS ativas por seu status atual."></i></div><div class="card-body chart-container"><canvas id="osByStatusChart"></canvas></div></div></div>
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">OS por Prioridade</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Distribuição das OS por nível de prioridade."></i></div><div class="card-body chart-container"><canvas id="osByPriorityChart"></canvas></div></div></div>
                </div>
            </div>

            <!-- Aba Análise de Ativos -->
            <div class="tab-pane fade" id="assets-pane" role="tabpanel">
                 <div class="row">
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">Top 5 Ativos com Mais Falhas</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Os ativos que mais geraram Ordens de Serviço corretivas no período."></i></div><div class="card-body chart-container"><canvas id="topAssetsChart"></canvas></div></div></div>
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">Custo de Manutenção por Ativo</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Custo total com peças utilizadas nas manutenções de cada ativo."></i></div><div class="card-body chart-container"><canvas id="costByAssetChart"></canvas></div></div></div>
                </div>
            </div>

            <!-- Aba Performance da Equipe -->
            <div class="tab-pane fade" id="team-pane" role="tabpanel">
                <div class="row">
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">OS Concluídas por Técnico</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Número total de Ordens de Serviço que cada técnico concluiu no período."></i></div><div class="card-body chart-container"><canvas id="osByTechnicianChart"></canvas></div></div></div>
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">Média de Avaliação (Feedback) por Técnico</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Nota média (1 a 5) recebida por cada técnico com base no feedback dos solicitantes."></i></div><div class="card-body chart-container"><canvas id="feedbackByTechnicianChart"></canvas></div></div></div>
                </div>
            </div>
            
            <!-- Aba Análises Avançadas -->
            <div class="tab-pane fade" id="advanced-pane" role="tabpanel">
                 <div class="row mb-4">
                     <div class="col-lg-3 col-md-6 mb-3"><div class="card kpi-card bg-light"><div class="card-body"><div class="icon-circle bg-danger text-white"><i class="bi bi-hourglass-split"></i></div><div><h6 class="card-subtitle text-muted">Backlog (Abertas) <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Tempo médio que as OS com status 'Aberta' estão aguardando para serem iniciadas."></i></h6><h4 class="card-title fw-bold mb-0">3.5 dias</h4></div></div></div></div>
                     <div class="col-lg-3 col-md-6 mb-3"><div class="card kpi-card bg-light"><div class="card-body"><div class="icon-circle bg-info text-white"><i class="bi bi-fast-forward-btn"></i></div><div><h6 class="card-subtitle text-muted">Tempo de Triagem <i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Tempo médio entre a abertura de um Ticket e a criação da respectiva Ordem de Serviço."></i></h6><h4 class="card-title fw-bold mb-0">8 horas</h4></div></div></div></div>
                 </div>
                 <div class="row">
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">Análise de Causa Raiz (Pareto)</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="As causas mais comuns de falhas, ajudando a identificar onde focar os esforços de melhoria."></i></div><div class="card-body chart-container"><canvas id="rootCauseChart"></canvas></div></div></div>
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">Manutenção Corretiva vs. Preventiva</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Proporção de OS geradas por falhas (Corretiva) vs. as planejadas (Preventiva)."></i></div><div class="card-body chart-container"><canvas id="correctiveVsPreventiveChart"></canvas></div></div></div>
                    <div class="col-lg-6 mb-4"><div class="card"><div class="card-header d-flex justify-content-between"><h5 class="card-title mb-0">Top 5 Peças Mais Consumidas</h5><i class="bi bi-info-circle-fill info-icon" data-bs-toggle="tooltip" title="Peças mais utilizadas em Ordens de Serviço, por quantidade."></i></div><div class="card-body chart-container"><canvas id="topPartsChart"></canvas></div></div></div>
                 </div>
            </div>
        </div>
    </main>

    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) { return new bootstrap.Tooltip(tooltipTriggerEl) });

            const mockData = {
                osByStatus: { labels: ['Concluída', 'Aberta', 'Em Progresso', 'Aguardando Aprovação'], data: [85, 22, 15, 8] },
                topAssets: { labels: ['Prensa P-05', 'Compressor C-101', 'Esteira E-22', 'Forno F-01', 'Bomba B-52'], data: [12, 9, 7, 5, 4] },
                osByTechnician: { labels: ['João Silva', 'Ana Souza', 'Carlos Pereira', 'Mariana Costa'], data: [52, 45, 31, 14] },
                osByPriority: { labels: ['1-Urgente', '2-Alta', '3-Normal', '4-Baixa'], data: [18, 41, 78, 5] },
                costByAsset: { labels: ['Prensa P-05', 'Compressor C-101', 'Forno F-01', 'Esteira E-22'], data: [1250.50, 875.20, 650.00, 430.80] },
                rootCause: { labels: ['Falta de Lubrificação', 'Falha Elétrica', 'Desgaste Natural', 'Erro Operacional', 'Outros'], data: [45, 30, 25, 15, 10] },
                feedbackByTechnician: { labels: ['João Silva', 'Ana Souza', 'Carlos Pereira', 'Mariana Costa'], data: [4.8, 4.5, 4.6, 4.9] },
                correctiveVsPreventive: { labels: ['Corretiva (Falha)', 'Preventiva (Planejada)'], data: [65, 35] },
                topParts: { labels: ['Filtro HEPA-250', 'Rolamento 6203', 'Correia A-36', 'Óleo Sintético', 'Parafuso M8'], data: [58, 42, 35, 25, 18] },
            };

            const chartColors = {
                blue: 'rgba(13, 110, 253, 0.7)', red: 'rgba(220, 53, 69, 0.7)', yellow: 'rgba(255, 193, 7, 0.7)',
                green: 'rgba(25, 135, 84, 0.7)', cyan: 'rgba(13, 202, 240, 0.7)', gray: 'rgba(108, 117, 125, 0.7)',
                orange: 'rgba(253, 126, 20, 0.7)'
            };

            const chartInstances = {};
            function createChart(id, type, data, options = {}) {
                const canvas = document.getElementById(id);
                if (!canvas) return;
                if (chartInstances[id]) { chartInstances[id].destroy(); }
                const ctx = canvas.getContext('2d');
                chartInstances[id] = new Chart(ctx, { type, data, options });
            }
            
            function renderOverviewCharts() {
                createChart('osByStatusChart', 'doughnut', { labels: mockData.osByStatus.labels, datasets: [{ data: mockData.osByStatus.data, backgroundColor: [chartColors.green, chartColors.blue, chartColors.cyan, chartColors.yellow] }] }, { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } });
                createChart('osByPriorityChart', 'pie', { labels: mockData.osByPriority.labels, datasets: [{ data: mockData.osByPriority.data, backgroundColor: [chartColors.red, chartColors.yellow, chartColors.green, chartColors.gray] }] }, { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } });
            }

            document.getElementById('assets-tab').addEventListener('shown.bs.tab', function() {
                createChart('topAssetsChart', 'bar', { labels: mockData.topAssets.labels, datasets: [{ label: 'Nº de Falhas', data: mockData.topAssets.data, backgroundColor: chartColors.red }] }, { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } });
                createChart('costByAssetChart', 'bar', { labels: mockData.costByAsset.labels, datasets: [{ label: 'Custo (R$)', data: mockData.costByAsset.data, backgroundColor: chartColors.yellow }] }, { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { callback: value => 'R$ ' + value } } } });
            });

            document.getElementById('team-tab').addEventListener('shown.bs.tab', function() {
                createChart('osByTechnicianChart', 'bar', { labels: mockData.osByTechnician.labels, datasets: [{ label: 'OS Concluídas', data: mockData.osByTechnician.data, backgroundColor: chartColors.blue }] }, { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } });
                createChart('feedbackByTechnicianChart', 'bar', {
                    labels: mockData.feedbackByTechnician.labels,
                    datasets: [{ label: 'Média de Avaliação', data: mockData.feedbackByTechnician.data, backgroundColor: chartColors.green }]
                }, { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 5 } }, plugins: { legend: { display: false } } });
            });
            
            document.getElementById('advanced-tab').addEventListener('shown.bs.tab', function() {
                const paretoData = mockData.rootCause.data.sort((a, b) => b - a);
                const paretoLabels = mockData.rootCause.labels;
                const total = paretoData.reduce((acc, val) => acc + val, 0);
                let cumulativePercentage = 0;
                const paretoLineData = paretoData.map(val => { cumulativePercentage += (val / total) * 100; return cumulativePercentage; });
                createChart('rootCauseChart', 'bar', { labels: paretoLabels, datasets: [ { type: 'bar', label: 'Nº de Ocorrências', data: paretoData, backgroundColor: chartColors.blue }, { type: 'line', label: 'Cumulativo %', data: paretoLineData, borderColor: chartColors.red, yAxisID: 'y1' } ] }, { responsive: true, maintainAspectRatio: false, scales: { y: { type: 'linear', display: true, position: 'left' }, y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, ticks: { callback: value => value.toFixed(0) + '%' } } } });
                createChart('correctiveVsPreventiveChart', 'pie', { labels: mockData.correctiveVsPreventive.labels, datasets: [{ data: mockData.correctiveVsPreventive.data, backgroundColor: [chartColors.red, chartColors.green] }] }, { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } });
                createChart('topPartsChart', 'bar', { labels: mockData.topParts.labels, datasets: [{ label: 'Unidades Consumidas', data: mockData.topParts.data, backgroundColor: chartColors.orange }] }, { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } });
            });

            renderOverviewCharts();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Etiquetas QR Code - CMMS Pro</title>

    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            height: calc(100vh - 56px - 3rem); /* Full height minus navbar and padding */
        }
        .controls-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .preview-panel {
             height: 100%;
             overflow-y: auto;
             background-color: #e9ecef;
             padding: 1rem;
             border-radius: 0.5rem;
        }
        .asset-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .preview-sheet {
            background-color: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            margin: 0 auto 2rem auto; /* Margin bottom for multiple pages */
            padding: 1cm;
            display: grid;
            gap: 5mm;
            overflow: hidden;
        }
        .qr-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            text-align: center;
            padding: 5%; /* Proportional padding */
            border: 1px dashed #adb5bd;
            background-color: #fff;
            box-sizing: border-box;
            overflow: hidden;
            aspect-ratio: 1 / 1.414; /* Standard paper proportion */
        }
        .qr-label .qr-code {
            width: 80%; /* Relative width for the container */
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .qr-label .qr-code img {
             width: 100%; /* Image will fill the container */
             height: auto;
        }
        .qr-label .asset-info {
            flex-shrink: 0;
            width: 100%;
        }
        .qr-label .asset-name { font-weight: 700; word-break: break-word; }
        .qr-label .asset-tag { font-family: monospace; color: #495057; }
        .qr-label .cta-text { color: #6c757d; margin-top: 5%; }

        /* --- LOGICA DE LAYOUT DE GRID E ORIENTAÇÃO --- */
        .preview-sheet.layout-a4, .preview-sheet.layout-a6, .preview-sheet.layout-a8 { 
            aspect-ratio: 210 / 297; /* Retrato */
        }
        .preview-sheet.layout-a5, .preview-sheet.layout-a7 { 
            aspect-ratio: 297 / 210; /* Paisagem */
        }
        
        .preview-sheet.layout-a4 { grid-template-columns: 1fr; }
        .preview-sheet.layout-a5 { grid-template-columns: repeat(2, 1fr); }
        .preview-sheet.layout-a6 { grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); }
        .preview-sheet.layout-a7 { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(2, 1fr); }
        .preview-sheet.layout-a8 { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(4, 1fr); }

        /* --- LOGICA DE FONTES PROPORCIONAIS CORRIGIDA --- */
        /* Grupo A4 (Maior) */
        .layout-a4 .qr-label .asset-name { font-size: 1.6rem; }
        .layout-a4 .qr-label .asset-tag { font-size: 1.3rem; }
        .layout-a4 .qr-label .cta-text { font-size: 1.0rem; }

        /* Grupo A5/A6 (Médio) */
        .layout-a5 .qr-label .asset-name, .layout-a6 .qr-label .asset-name { font-size: 0.8rem; }
        .layout-a5 .qr-label .asset-tag, .layout-a6 .qr-label .asset-tag { font-size: 0.65rem; }
        .layout-a5 .qr-label .cta-text, .layout-a6 .qr-label .cta-text { font-size: 0.5rem; }
        
        /* Grupo A7/A8 (Pequeno) */
        .layout-a7 .qr-label .asset-name, .layout-a8 .qr-label .asset-name { font-size: 0.45rem; }
        .layout-a7 .qr-label .asset-tag, .layout-a8 .qr-label .asset-tag { font-size: 0.35rem; }
        .layout-a7 .qr-label .cta-text, .layout-a8 .qr-label .cta-text { font-size: 0.3rem; }
        
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        @media print {
            body * { visibility: hidden; }
            .preview-panel, .preview-sheet, .preview-sheet * { visibility: visible; }
            .preview-panel { padding: 0; overflow: visible; }
            .preview-sheet {
                position: relative;
                width: 210mm;
                height: 297mm;
                max-width: none;
                padding: 1cm;
                margin: 0;
                box-shadow: none;
                page-break-after: always;
            }
            .preview-sheet.layout-a5, .preview-sheet.layout-a7 {
                width: 297mm;
                height: 210mm;
                size: A4 landscape;
            }
            .qr-label { border: 1px solid #000; }
            @page {
                size: A4;
                margin: 0;
            }
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-3">
        <div class="main-container">
            <!-- Painel de Controles -->
            <div class="controls-panel">
                <div class="card flex-grow-1">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-gear-fill me-2"></i>Configurações de Geração</h5>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <!-- 1. Seleção de Ativos -->
                        <h6>1. Selecione os Ativos</h6>
                        <div class="mb-3">
                            <input type="text" id="assetSearch" class="form-control" placeholder="Buscar ativo...">
                        </div>
                        <div class="list-group asset-list" id="assetList">
                           <!-- Assets serão inseridos aqui via JS -->
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                           <small class="text-muted"><span id="selected-count">0</span> de <span id="total-count">0</span> selecionados</small>
                           <div>
                                <a href="#" id="selectAll" class="small">Selecionar todos</a> |
                                <a href="#" id="deselectAll" class="small">Limpar</a>
                           </div>
                        </div>
                        <hr>
                        <!-- 2. Tamanho da Etiqueta -->
                        <h6 class="mt-3">2. Escolha o Tamanho da Etiqueta</h6>
                        <div id="size-selector" class="d-flex flex-wrap gap-2">
                            <input type="radio" class="btn-check" name="label-size" id="size-a8" value="a8" checked>
                            <label class="btn btn-outline-secondary" for="size-a8">A8 (16)</label>
                            
                            <input type="radio" class="btn-check" name="label-size" id="size-a7" value="a7">
                            <label class="btn btn-outline-secondary" for="size-a7">A7 (8)</label>

                            <input type="radio" class="btn-check" name="label-size" id="size-a6" value="a6">
                            <label class="btn btn-outline-secondary" for="size-a6">A6 (4)</label>

                            <input type="radio" class="btn-check" name="label-size" id="size-a5" value="a5">
                            <label class="btn btn-outline-secondary" for="size-a5">A5 (2)</label>

                            <input type="radio" class="btn-check" name="label-size" id="size-a4" value="a4">
                            <label class="btn btn-outline-secondary" for="size-a4">A4 (1)</label>
                        </div>
                         <div class="mt-auto">
                            <hr>
                            <div id="print-summary" class="text-center text-muted small mb-3">
                                Selecione os ativos e o tamanho para ver o resumo.
                            </div>
                            <button class="btn btn-lg btn-success w-100" onclick="window.print();">
                                <i class="bi bi-printer-fill me-2"></i>Imprimir Folha(s)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Painel de Pré-visualização -->
            <div class="preview-panel" id="preview-container">
                <!-- Folhas de pré-visualização serão renderizadas aqui -->
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mockAssets = [
                { id: 'a1b2c3d4-e5f6-7890-1234-567890abcdef', name: 'Compressor de Ar C-101', tag: 'COMP-00101' },
                { id: 'b2c3d4e5-f6a7-8901-2345-67890abcdef1', name: 'Forno Industrial F-01', tag: 'FORN-0001' },
                { id: 'c3d4e5f6-a7b8-9012-3456-7890abcdef12', name: 'Esteira Transportadora E-22', tag: 'EST-0022' },
                { id: 'd4e5f6a7-b8c9-0123-4567-890abcdef123', name: 'Empilhadeira Elétrica E-03', tag: 'EMP-0003' },
                { id: 'e5f6a7b8-c9d0-1234-5678-90abcdef1234', name: 'Prensa Hidráulica P-05', tag: 'PREN-0005' },
                { id: 'f6a7b8c9-d0e1-2345-6789-0abcdef12345', name: 'Bomba Hidráulica B-52', tag: 'BOMB-0052' },
                { id: 'a7b8c9d0-e1f2-3456-7890-bcdef1234567', name: 'Motor Elétrico M-08', tag: 'MOT-0008' },
                { id: 'b8c9d0e1-f2a3-4567-8901-cdef12345678', name: 'Painel de Controle PC-02', tag: 'PAINEL-002' },
                { id: 'c9d0e1f2-a3b4-5678-9012-def123456789', name: 'Sistema de Ventilação SV-11', tag: 'VENT-011' },
                { id: 'd0e1f2a3-b4c5-6789-0123-ef1234567890', name: 'Reservatório de Água R-01', tag: 'RES-001' }
            ];

            const assetListContainer = document.getElementById('assetList');
            const assetSearchInput = document.getElementById('assetSearch');
            const previewContainer = document.getElementById('preview-container');
            const sizeSelector = document.getElementById('size-selector');
            const selectedCountEl = document.getElementById('selected-count');
            const printSummaryEl = document.getElementById('print-summary');
            
            const capacities = { a4: 1, a5: 2, a6: 4, a7: 8, a8: 16 };
            let selectedAssets = new Set();
            let currentLayout = 'a8';

            function populateAssetList() {
                assetListContainer.innerHTML = '';
                mockAssets.forEach(asset => {
                    const item = document.createElement('label');
                    item.className = 'list-group-item';
                    item.innerHTML = `
                        <input class="form-check-input me-2" type="checkbox" value="${asset.id}" data-name="${asset.name}">
                        <div>
                            <div class="fw-bold">${asset.name}</div>
                            <small class="text-muted">${asset.tag}</small>
                        </div>
                    `;
                    assetListContainer.appendChild(item);
                });
                document.getElementById('total-count').textContent = mockAssets.length;
            }

            function renderPreview() {
                previewContainer.innerHTML = '';
                const baseURL = window.location.origin + window.location.pathname.replace('qrcode_generator.html', 'mobile_ticket_creation.html');
                const assetArray = Array.from(selectedAssets);

                if (assetArray.length === 0) {
                     printSummaryEl.textContent = 'Selecione os ativos e o tamanho para ver o resumo.';
                     return;
                }

                const labelsPerPage = capacities[currentLayout];
                const totalPages = Math.ceil(assetArray.length / labelsPerPage);
                
                printSummaryEl.innerHTML = `Serão impressas <strong>${totalPages}</strong> página(s) A4.`;

                for (let i = 0; i < totalPages; i++) {
                    const pageSheet = document.createElement('div');
                    pageSheet.className = `preview-sheet layout-${currentLayout}`;
                    
                    const assetsForPage = assetArray.slice(i * labelsPerPage, (i + 1) * labelsPerPage);

                    assetsForPage.forEach(assetId => {
                        const asset = mockAssets.find(a => a.id === assetId);
                        if (!asset) return;
                        pageSheet.appendChild(createLabelElement(asset, baseURL));
                    });
                    previewContainer.appendChild(pageSheet);
                }
            }
            
            function createLabelElement(asset, baseURL) {
                const label = document.createElement('div');
                label.className = `qr-label`;
                
                const qrContainer = document.createElement('div');
                qrContainer.className = 'qr-code';
                
                const assetInfo = document.createElement('div');
                assetInfo.className = 'asset-info';

                const nameEl = document.createElement('div');
                nameEl.className = 'asset-name';
                nameEl.textContent = asset.name;

                const tagEl = document.createElement('div');
                tagEl.className = 'asset-tag';
                tagEl.textContent = asset.tag;
                
                const ctaEl = document.createElement('div');
                ctaEl.className = 'cta-text';
                ctaEl.innerHTML = '<i class="bi bi-qr-code-scan"></i> Aponte para abrir chamado';

                assetInfo.appendChild(nameEl);
                assetInfo.appendChild(tagEl);
                assetInfo.appendChild(ctaEl);
                
                label.appendChild(qrContainer);
                label.appendChild(assetInfo);
                
                try {
                    const typeNumber = 0;
                    const errorCorrectionLevel = 'L';
                    const qr = qrcode(typeNumber, errorCorrectionLevel);
                    const urlToEncode = `${baseURL}?asset_id=${asset.id}`;
                    qr.addData(urlToEncode);
                    qr.make();
                    qrContainer.innerHTML = qr.createImgTag(4, 2);
                } catch (e) {
                    qrContainer.innerHTML = 'Erro ao gerar QR Code';
                }
                return label;
            }

            function handleSelectionChange() {
                 selectedAssets.clear();
                 assetListContainer.querySelectorAll('input[type="checkbox"]:checked').forEach(chk => {
                     selectedAssets.add(chk.value);
                 });
                 selectedCountEl.textContent = selectedAssets.size;
                 renderPreview();
            }

            assetListContainer.addEventListener('change', handleSelectionChange);

            sizeSelector.addEventListener('change', (e) => {
                if (e.target.name === 'label-size') {
                    currentLayout = e.target.value;
                    renderPreview();
                }
            });

            assetSearchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                assetListContainer.querySelectorAll('.list-group-item').forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            });
            
            document.getElementById('selectAll').addEventListener('click', (e) => {
                e.preventDefault();
                assetListContainer.querySelectorAll('input[type="checkbox"]').forEach(chk => { chk.checked = true; });
                handleSelectionChange();
            });

            document.getElementById('deselectAll').addEventListener('click', (e) => {
                e.preventDefault();
                assetListContainer.querySelectorAll('input[type="checkbox"]').forEach(chk => { chk.checked = false; });
                handleSelectionChange();
            });

            populateAssetList();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Técnico - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FullCalendar -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .portal-header {
            background-color: #343a40;
            color: white;
        }
        .nav-pills .nav-link {
            color: #495057;
        }
        .nav-pills .nav-link.active {
            background-color: #0d6efd;
            font-weight: 600;
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,.08);
        }
        .task-card {
            border-left: 5px solid #0d6efd;
            transition: all 0.2s ease-in-out;
        }
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,.1);
        }
        .task-card.priority-1 { border-left-color: #dc3545; } /* Urgente */
        .task-card.priority-2 { border-left-color: #fd7e14; } /* Alta */
        .task-card.priority-3 { border-left-color: #ffc107; } /* Normal */
        
        .timeline {
            position: relative;
            padding-left: 2rem;
            border-left: 3px solid #dee2e6;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
        }
        .timeline-item .icon {
            position: absolute;
            left: -1.2rem;
            top: 0;
            width: 2.2rem;
            height: 2.2rem;
            border-radius: 50%;
            background-color: #f0f2f5;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        .timeline-item.next-task .icon { background-color: #0d6efd; }
        .timeline-item.pending-task .icon { background-color: #6c757d; }
        
        @keyframes pulse-mic {
            0% { box-shadow: 0 0 0 0 rgba(13, 110, 253, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(13, 110, 253, 0); }
            100% { box-shadow: 0 0 0 0 rgba(13, 110, 253, 0); }
        }
        .recording {
            animation: pulse-mic 2s infinite;
        }
    </style>
</head>
<body>

    <!-- Cabeçalho do Portal -->
    <header class="portal-header p-3 shadow-sm">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-person-gear me-2"></i>Painel do Técnico</h4>
            <div class="d-flex align-items-center">
                <i class="bi bi-person-circle fs-4 me-2"></i>
                <div>
                    <div class="fw-bold">João Silva</div>
                    <small class="text-white-50">Técnico Mecânico</small>
                </div>
            </div>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-3 p-lg-4">

        <!-- Abas de Navegação -->
        <ul class="nav nav-pills nav-fill mb-4" id="technicianTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="today-tab" data-bs-toggle="tab" data-bs-target="#today-pane" type="button" role="tab">
                    <i class="bi bi-calendar-day me-1"></i> Hoje
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="week-tab" data-bs-toggle="tab" data-bs-target="#week-pane" type="button" role="tab">
                    <i class="bi bi-calendar-week me-1"></i> Minha Semana
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed-pane" type="button" role="tab">
                    <i class="bi bi-check2-all me-1"></i> Minhas OS Concluídas
                </button>
            </li>
        </ul>

        <!-- Conteúdo das Abas -->
        <div class="tab-content" id="technicianTabContent">

            <!-- Aba "Hoje" -->
            <div class="tab-pane fade show active" id="today-pane" role="tabpanel">
                <h4 class="mb-4">Minha Agenda para Hoje, 17 de Outubro</h4>
                <div class="timeline">
                    <!-- Próxima Tarefa -->
                    <div class="timeline-item next-task">
                        <div class="icon"><i class="bi bi-play-fill"></i></div>
                        <p class="text-muted mb-1">Próxima Tarefa - Início em 38 minutos</p>
                        <div class="card task-card priority-2">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <h5 class="card-title">OS-124: Reparo no sistema de refrigeração</h5>
                                    <span class="badge bg-primary fs-6">13:00 - 15:00</span>
                                </div>
                                <p class="card-subtitle mb-2 text-muted"><strong>Ativo:</strong> Forno Industrial F-01</p>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#executionModal">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>Ver e Iniciar OS
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Tarefa Pendente -->
                    <div class="timeline-item pending-task">
                        <div class="icon"><i class="bi bi-clock"></i></div>
                        <p class="text-muted mb-1">Aguardando</p>
                        <div class="card task-card priority-3">
                             <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <h5 class="card-title">OS-126: Troca de rolamento do motor principal</h5>
                                    <span class="badge bg-secondary fs-6">15:30 - 16:30</span>
                                </div>
                                <p class="card-subtitle mb-2 text-muted"><strong>Ativo:</strong> Esteira Transportadora E-22</p>
                                <button class="btn btn-outline-secondary" disabled>Aguardando OS anterior</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba "Minha Semana" -->
            <div class="tab-pane fade" id="week-pane" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <div id="calendar"></div>
                    </div>
                </div>
            </div>

            <!-- Aba "Minhas OS Concluídas" -->
            <div class="tab-pane fade" id="completed-pane" role="tabpanel">
                 <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Histórico de Ordens de Serviço Executadas</h5>
                        <div class="list-group">
                             <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1 fw-bold">OS-122: Troca de filtro e óleo</h6>
                                    <small>Concluída em 10/10/2025</small>
                                </div>
                                <p class="mb-1"><strong>Ativo:</strong> Compressor de Ar C-101</p>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1 fw-bold">OS-098: Verificar ruído anormal no motor</h6>
                                    <small>Concluída em 15/07/2025</small>
                                </div>
                                <p class="mb-1"><strong>Ativo:</strong> Compressor de Ar C-101</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Execução de OS -->
    <div class="modal fade" id="executionModal" tabindex="-1" data-bs-backdrop="static">
      <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Execução da OS-124</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
                <div class="col-md-4">
                    <h6><i class="bi bi-info-circle me-2"></i>Detalhes</h6>
                    <p><strong>Ativo:</strong> Forno Industrial F-01</p>
                    <p><strong>Descrição:</strong> O forno não está atingindo a temperatura correta. Verificar resistência e sistema de refrigeração.</p>
                    <p><strong>Status:</strong> <span class="badge bg-primary">Aberta</span></p>
                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-info" id="startWorkBtn"><i class="bi bi-play-circle-fill me-2"></i>Iniciar Trabalho</button>
                        <button class="btn btn-warning" disabled><i class="bi bi-pause-circle-fill me-2"></i>Pausar Trabalho</button>
                    </div>
                </div>
                <div class="col-md-8 border-start">
                    <h6><i class="bi bi-pencil-square me-2"></i>Relatório de Conclusão</h6>
                    <p class="text-muted small">Preencha os campos abaixo para finalizar a ordem de serviço. Você pode usar o microfone para ditar o texto.</p>
                    <div class="mb-3">
                        <label for="rootCause" class="form-label">Causa Raiz</label>
                        <div class="input-group">
                            <textarea class="form-control" id="rootCause" rows="3" placeholder="Descreva a causa fundamental do problema."></textarea>
                            <button class="btn btn-outline-primary ai-btn" type="button" data-bs-toggle="tooltip" title="Gravar com IA"><i class="bi bi-mic-fill"></i></button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="actionTaken" class="form-label">Ação Realizada</label>
                        <div class="input-group">
                            <textarea class="form-control" id="actionTaken" rows="4" placeholder="Descreva em detalhes o trabalho que foi executado."></textarea>
                            <button class="btn btn-outline-primary ai-btn" type="button" data-bs-toggle="tooltip" title="Gravar com IA"><i class="bi bi-mic-fill"></i></button>
                        </div>
                    </div>
                    <hr>
                    <h6><i class="bi bi-tools me-2"></i>Peças Utilizadas</h6>
                    <!-- Formulário para adicionar peças -->
                    <p class="text-muted fst-italic">Nenhuma peça registrada.</p>
                    <hr>
                    <h6><i class="bi bi-camera me-2"></i>Fotos</h6>
                     <!-- Formulário para adicionar fotos -->
                     <p class="text-muted fst-italic">Nenhuma foto adicionada.</p>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <button type="button" class="btn btn-success" disabled><i class="bi bi-check-all me-2"></i>Concluir e Finalizar OS</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendarTab = document.getElementById('week-tab');
            var calendar;

            // Inicializa o calendário na aba "Minha Semana"
            calendarTab.addEventListener('shown.bs.tab', function () {
                if (!calendar) {
                    calendar = new FullCalendar.Calendar(calendarEl, {
                        locale: 'pt-br',
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridWeek,timeGridDay,listWeek'
                        },
                        initialView: 'dayGridWeek',
                        initialDate: '2025-10-17',
                        events: [
                            {
                                title: 'OS-124: Reparo Forno',
                                start: '2025-10-17T13:00:00',
                                end: '2025-10-17T15:00:00',
                                color: '#0d6efd'
                            },
                             {
                                title: 'OS-126: Troca rolamento',
                                start: '2025-10-17T15:30:00',
                                end: '2025-10-17T16:30:00',
                                color: '#6c757d'
                            },
                            {
                                title: 'PM: Inspeção Elétrica',
                                start: '2025-10-20',
                                allDay: true,
                                color: '#198754'
                            }
                        ]
                    });
                    calendar.render();
                }
            });

            // Lógica do botão "Iniciar Trabalho"
            const startWorkBtn = document.getElementById('startWorkBtn');
            startWorkBtn.addEventListener('click', function() {
                this.classList.remove('btn-info');
                this.classList.add('btn-success');
                this.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>Trabalho Iniciado';
                this.disabled = true;

                const modal = this.closest('.modal');
                modal.querySelector('.badge').textContent = 'Em Progresso';
                modal.querySelector('.badge').classList.remove('bg-primary');
                modal.querySelector('.badge').classList.add('bg-info', 'text-dark');
                
                modal.querySelector('.btn-warning').disabled = false;
                modal.querySelector('.btn-success').disabled = false;
            });

            // Lógica da IA (simulação)
            const aiButtons = document.querySelectorAll('.ai-btn');
            aiButtons.forEach(button => {
                let isRecording = false;
                button.addEventListener('click', function() {
                    isRecording = !isRecording;
                    const icon = this.querySelector('i');
                    const targetTextarea = this.previousElementSibling;

                    if(isRecording) {
                        this.classList.add('recording', 'btn-danger');
                        this.classList.remove('btn-outline-primary');
                        icon.classList.remove('bi-mic-fill');
                        icon.classList.add('bi-stop-circle-fill');
                        
                        // Simulação: após 3 segundos, para de gravar e preenche
                        setTimeout(() => {
                            isRecording = false;
                            this.classList.remove('recording', 'btn-danger');
                            this.classList.add('btn-outline-primary');
                            icon.classList.add('bi-mic-fill');
                            icon.classList.remove('bi-stop-circle-fill');

                            if (targetTextarea.id === 'rootCause') {
                                targetTextarea.value = "Análise da IA: A resistência R2 do circuito de aquecimento estava queimada, causando uma falha na elevação da temperatura.";
                            } else {
                                targetTextarea.value = "Análise da IA: Foi realizada a substituição da resistência R2 por uma nova. O sistema foi testado e a temperatura normalizada.";
                            }
                        }, 3000);

                    } else {
                        // Lógica para parar manualmente (se necessário)
                    }
                });
            });

            // Ativa tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Inventário e Peças - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.025);
        }
        .nav-link.active {
            font-weight: 600;
        }
        .stock-low {
            background-color: #fff3cd !important;
            --bs-table-hover-bg: #ffeeba !important;
        }
        .stock-low .quantity {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="asset_management_list.html">Ativos</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="inventory_management.html">Inventário</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">Gestão de Inventário e Peças</h1>
            <div>
                <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#transactionModal">
                    <i class="bi bi-arrow-down-up me-2"></i>Nova Movimentação
                </button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#partModal">
                    <i class="bi bi-plus-circle-fill me-2"></i>Adicionar Nova Peça
                </button>
            </div>
        </div>

        <!-- Filtros e Busca -->
        <div class="card mb-4">
            <div class="card-body">
                <form class="row g-3 align-items-end">
                    <div class="col-md-6">
                        <label for="searchPart" class="form-label">Buscar por Peça</label>
                        <input type="text" class="form-control" id="searchPart" placeholder="Digite o nome, SKU ou número da peça...">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label invisible">Filtro de Estoque</label>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="lowStockFilter">
                          <label class="form-check-label" for="lowStockFilter">
                            Mostrar apenas peças com estoque baixo
                          </label>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-secondary w-100"><i class="bi bi-filter me-2"></i>Filtrar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabela de Peças -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Nome da Peça</th>
                                <th scope="col">SKU / Part Number</th>
                                <th scope="col" class="text-center">Quantidade em Estoque</th>
                                <th scope="col" class="text-center">Ponto de Reposição</th>
                                <th scope="col" class="text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="stock-low">
                                <td class="fw-bold">Filtro de ar HEPA-250</td>
                                <td><code>FA-HEPA-250</code></td>
                                <td class="text-center quantity">4</td>
                                <td class="text-center">5</td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary" title="Ver Histórico"><i class="bi bi-clock-history"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Rolamento 6203-2RS</td>
                                <td><code>ROL-6203-2RS</code></td>
                                <td class="text-center quantity">25</td>
                                <td class="text-center">10</td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary" title="Ver Histórico"><i class="bi bi-clock-history"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Óleo Lubrificante Sintético ISO VG 46</td>
                                <td><code>OLEO-SINT-46</code></td>
                                <td class="text-center quantity">12 L</td>
                                <td class="text-center">20 L</td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary" title="Ver Histórico"><i class="bi bi-clock-history"></i></button>
                                </td>
                            </tr>
                              <tr class="stock-low">
                                <td class="fw-bold">Correia V-Belt A-36</td>
                                <td><code>COR-A36</code></td>
                                <td class="text-center quantity">2</td>
                                <td class="text-center">5</td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary" title="Ver Histórico"><i class="bi bi-clock-history"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal: Adicionar/Editar Peça -->
    <div class="modal fade" id="partModal" tabindex="-1" aria-labelledby="partModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="partModalLabel">Adicionar Nova Peça</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="part-form">
              <div class="mb-3">
                <label for="partName" class="form-label">Nome da Peça</label>
                <input type="text" class="form-control" id="partName" placeholder="Ex: Rolamento 6203-2RS" required>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                    <label for="partSku" class="form-label">SKU / Part Number</label>
                    <input type="text" class="form-control" id="partSku" placeholder="Ex: ROL-6203-2RS">
                </div>
                <div class="col-md-6">
                    <label for="reorderPoint" class="form-label">Ponto de Reposição</label>
                    <input type="number" class="form-control" id="reorderPoint" placeholder="Ex: 10" required>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary" form="part-form"><i class="bi bi-check-circle me-2"></i>Salvar Peça</button>
          </div>
        </div>
      </div>
    </div>

     <!-- Modal: Nova Movimentação -->
    <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="transactionModalLabel">Nova Movimentação de Inventário</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="transaction-form">
              <div class="mb-3">
                  <label class="form-label">Tipo de Transação</label>
                  <div>
                      <input type="radio" class="btn-check" name="transactionType" id="type-add" value="addition" checked>
                      <label class="btn btn-outline-success" for="type-add"><i class="bi bi-plus-lg me-1"></i> Entrada</label>

                      <input type="radio" class="btn-check" name="transactionType" id="type-deduct" value="deduction">
                      <label class="btn btn-outline-danger" for="type-deduct"><i class="bi bi-dash-lg me-1"></i> Saída</label>

                      <input type="radio" class="btn-check" name="transactionType" id="type-adjust" value="adjustment">
                      <label class="btn btn-outline-warning" for="type-adjust"><i class="bi bi-pencil-fill me-1"></i> Ajuste</label>
                  </div>
              </div>
              <div class="mb-3">
                <label for="transactionPart" class="form-label">Peça</label>
                <select class="form-select" id="transactionPart" required>
                  <option value="" disabled selected>Selecione a peça a ser movimentada...</option>
                  <option value="1">Filtro de ar HEPA-250</option>
                  <option value="2">Rolamento 6203-2RS</option>
                  <option value="3">Óleo Lubrificante Sintético ISO VG 46</option>
                  <option value="4">Correia V-Belt A-36</option>
                </select>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                    <label for="quantityChanged" class="form-label">Quantidade</label>
                    <input type="number" class="form-control" id="quantityChanged" placeholder="Ex: 5" required>
                </div>
                <div class="col-md-6">
                    <label for="workOrderLink" class="form-label">Ordem de Serviço (Opcional)</label>
                    <input type="text" class="form-control" id="workOrderLink" placeholder="Vincular a uma OS (Ex: OS-124)">
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary" form="transaction-form"><i class="bi bi-check-circle me-2"></i>Registrar Movimentação</button>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simula o envio dos formulários
            document.getElementById('part-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const partModal = bootstrap.Modal.getInstance(document.getElementById('partModal'));
                partModal.hide();
                alert('Peça salva com sucesso! (Protótipo)');
            });

            document.getElementById('transaction-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const transactionModal = bootstrap.Modal.getInstance(document.getElementById('transactionModal'));
                transactionModal.hide();
                alert('Movimentação registrada com sucesso! (Protótipo)');
            });
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes da Peça: Filtro de ar HEPA-250 - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .nav-link.active {
            font-weight: 600;
        }
        .nav-tabs .nav-link {
            color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
            background-color: #f8f9fa;
            border-bottom-color: #f8f9fa;
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.025);
        }
        .transaction-in {
            color: #198754;
        }
        .transaction-out {
            color: #dc3545;
        }
        .transaction-adj {
            color: #ffc107;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="asset_management_list.html">Ativos</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="inventory_management.html">Inventário</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="h2 mb-0">Filtro de ar HEPA-250</h1>
                <p class="text-muted mb-0">SKU: <code>FA-HEPA-250</code></p>
            </div>
            <a href="inventory_management.html" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Voltar para o Inventário
            </a>
        </div>

        <div class="row">
            <!-- Coluna de Informações Gerais -->
            <div class="col-lg-4 mb-4">
                <div class="card position-sticky" style="top: 1rem;">
                    <div class="card-header"><h5 class="mb-0">Situação do Estoque</h5></div>
                    <div class="card-body text-center">
                        <h6 class="card-subtitle text-muted">Quantidade Atual</h6>
                        <p class="display-4 fw-bold text-danger">4</p>
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            Estoque abaixo do ponto de reposição (5 unidades).
                        </div>
                    </div>
                     <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Ponto de Reposição:</strong> 5 unidades</li>
                    </ul>
                    <div class="card-body border-top">
                        <h6 class="card-subtitle mb-2 text-muted">Ações</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-secondary"><i class="bi bi-arrow-down-up me-2"></i>Registrar Movimentação</button>
                            <button class="btn btn-primary"><i class="bi bi-pencil-square me-2"></i>Editar Peça</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coluna de Detalhes com Abas -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                         <ul class="nav nav-tabs card-header-tabs" id="part-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">Histórico de Movimentação</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="usage-tab" data-bs-toggle="tab" data-bs-target="#usage" type="button" role="tab">Análise de Consumo</button>
                            </li>
                             <li class="nav-item" role="presentation">
                                <button class="nav-link" id="assets-tab" data-bs-toggle="tab" data-bs-target="#assets" type="button" role="tab">Onde é Utilizada</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="part-tabs-content">
                            <!-- Aba de Histórico de Movimentação -->
                            <div class="tab-pane fade show active" id="history" role="tabpanel">
                                <h5 class="mb-3">Últimas Transações</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Tipo</th>
                                                <th class="text-center">Quantidade</th>
                                                <th>Usuário</th>
                                                <th>OS Vinculada</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="transaction-out">
                                                <td>15/10/2025 14:30</td>
                                                <td><i class="bi bi-arrow-up-circle-fill me-2"></i>Saída</td>
                                                <td class="text-center">-1</td>
                                                <td>João Silva</td>
                                                <td><a href="work_order_detail.html">OS-122</a></td>
                                            </tr>
                                            <tr class="transaction-in">
                                                <td>01/10/2025 09:00</td>
                                                <td><i class="bi bi-arrow-down-circle-fill me-2"></i>Entrada</td>
                                                <td class="text-center">+10</td>
                                                <td>Maria Almeida</td>
                                                <td>-</td>
                                            </tr>
                                            <tr class="transaction-out">
                                                <td>20/09/2025 11:15</td>
                                                <td><i class="bi bi-arrow-up-circle-fill me-2"></i>Saída</td>
                                                <td class="text-center">-2</td>
                                                <td>Ana Souza</td>
                                                 <td><a href="work_order_detail.html">OS-115</a></td>
                                            </tr>
                                             <tr class="transaction-adj">
                                                <td>01/09/2025 17:00</td>
                                                <td><i class="bi bi-pencil-fill me-2"></i>Ajuste</td>
                                                <td class="text-center">-1</td>
                                                <td>Maria Almeida</td>
                                                <td>-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Aba de Análise de Consumo -->
                            <div class="tab-pane fade" id="usage" role="tabpanel">
                                <h5 class="mb-3">Consumo Mensal (Últimos 6 meses)</h5>
                                <div>
                                    <canvas id="usageChart"></canvas>
                                </div>
                            </div>
                             <!-- Aba de Onde é Utilizada -->
                            <div class="tab-pane fade" id="assets" role="tabpanel">
                                 <h5 class="mb-3">Normalmente Utilizada nos Seguintes Ativos</h5>
                                 <ul class="list-group">
                                    <li class="list-group-item">
                                        <a href="asset_detail.html">Compressor de Ar C-101</a>
                                    </li>
                                     <li class="list-group-item">
                                        <a href="asset_detail.html">Sistema de Ventilação SV-11</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const usageChartCanvas = document.getElementById('usageChart');
            const usageTab = document.getElementById('usage-tab');
            let usageChart;

            usageTab.addEventListener('shown.bs.tab', event => {
                if (usageChart) return;

                usageChart = new Chart(usageChartCanvas, {
                    type: 'line',
                    data: {
                        labels: ['Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out'],
                        datasets: [{
                            label: 'Unidades Consumidas',
                            data: [2, 1, 3, 2, 2, 1],
                            fill: false,
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planos de Manutenção Preventiva - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.025);
        }
        .nav-link.active {
            font-weight: 600;
        }
        .status-vencido {
            color: #dc3545; /* Vermelho */
            font-weight: 600;
        }
        .status-ok {
            color: #198754; /* Verde */
        }
        tr.inactive {
            opacity: 0.6;
            background-color: #f1f1f1;
        }
        tr.inactive .fw-bold {
            text-decoration: line-through;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="pm_management_list.html">Manutenção Preventiva</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">Planos de Manutenção Preventiva</h1>
            <button class="btn btn-primary" id="createNewPmBtn">
                <i class="bi bi-plus-circle-fill me-2"></i>Criar Novo Plano de PM
            </button>
        </div>

        <!-- Filtros e Busca -->
        <div class="card mb-4">
            <div class="card-body">
                <form class="row g-3 align-items-end">
                    <div class="col-md-5">
                        <label for="searchAsset" class="form-label">Buscar por Ativo</label>
                        <input type="text" class="form-control" id="searchAsset" placeholder="Digite o nome ou tag do ativo...">
                    </div>
                    <div class="col-md-4">
                        <label for="locationFilter" class="form-label">Localização</label>
                        <select id="locationFilter" class="form-select">
                            <option selected>Todas as Localizações</option>
                            <option>Prédio A, Sala 101</option>
                            <option>Ala Norte - Produção</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-secondary w-100"><i class="bi bi-filter me-2"></i>Filtrar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabela de Planos de PM -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Tarefa</th>
                                <th scope="col">Ativo</th>
                                <th scope="col">Frequência</th>
                                <th scope="col">Última Execução</th>
                                <th scope="col">Próximo Vencimento</th>
                                <th scope="col" class="text-center">Status</th>
                                <th scope="col" class="text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="pm-table-body">
                            <!-- Linha Vencida -->
                            <tr data-plan-id="1" data-title="Inspeção e Limpeza de Filtros" data-asset-id="1" data-frequency="30" data-frequency-unit="days" data-start-date="2025-09-15" data-is-active="true">
                                <td class="fw-bold">Inspeção e Limpeza de Filtros</td>
                                <td>Compressor de Ar C-101</td>
                                <td>A cada 30 dias</td>
                                <td>15/09/2025</td>
                                <td class="due-date status-vencido" data-due-date="2025-10-15">15/10/2025</td>
                                <td class="text-center status-badge"><span class="badge bg-danger">Vencido</span></td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary edit-btn" title="Editar"><i class="bi bi-pencil-fill"></i></button>
                                    <button class="btn btn-sm btn-outline-danger toggle-status-btn" title="Desativar"><i class="bi bi-toggle-off"></i></button>
                                </td>
                            </tr>
                            <!-- Linha OK -->
                            <tr data-plan-id="2" data-title="Calibração de Sensores de Temperatura" data-asset-id="2" data-frequency="6" data-frequency-unit="months" data-start-date="2025-06-30" data-is-active="true">
                                <td class="fw-bold">Calibração de Sensores de Temperatura</td>
                                <td>Forno Industrial F-01</td>
                                <td>A cada 6 meses</td>
                                <td>30/06/2025</td>
                                <td class="due-date status-ok" data-due-date="2025-12-30">30/12/2025</td>
                                <td class="text-center status-badge"><span class="badge bg-success">Ativo</span></td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary edit-btn" title="Editar"><i class="bi bi-pencil-fill"></i></button>
                                    <button class="btn btn-sm btn-outline-danger toggle-status-btn" title="Desativar"><i class="bi bi-toggle-off"></i></button>
                                </td>
                            </tr>
                             <!-- Linha Inativa -->
                            <tr class="inactive" data-plan-id="3" data-title="Lubrificação de Rolamentos" data-asset-id="3" data-frequency="7" data-frequency-unit="days" data-start-date="2025-10-14" data-is-active="false">
                                <td class="fw-bold">Lubrificação de Rolamentos</td>
                                <td>Esteira Transportadora E-22</td>
                                <td>A cada 7 dias</td>
                                <td>14/10/2025</td>
                                <td class="due-date" data-due-date="2025-10-21">21/10/2025</td>
                                <td class="text-center status-badge"><span class="badge bg-secondary">Inativo</span></td>
                                <td class="text-end">
                                    <button class="btn btn-sm btn-outline-secondary edit-btn" title="Editar"><i class="bi bi-pencil-fill"></i></button>
                                    <button class="btn btn-sm btn-outline-success toggle-status-btn" title="Ativar"><i class="bi bi-toggle-on"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal: Criar/Editar Plano de PM -->
    <div class="modal fade" id="createPmModal" tabindex="-1" aria-labelledby="createPmModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createPmModalLabel">Criar Novo Plano de Manutenção Preventiva</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="pm-form">
              <input type="hidden" id="pmPlanId" name="pmPlanId">
              <div class="mb-3">
                <label for="pmTitle" class="form-label">Título da Tarefa</label>
                <input type="text" class="form-control" id="pmTitle" placeholder="Ex: Inspeção semanal de segurança" required>
              </div>
              <div class="mb-3">
                <label for="pmAsset" class="form-label">Ativo</label>
                <select class="form-select" id="pmAsset" required>
                  <option value="" disabled selected>Selecione o ativo...</option>
                  <option value="1">Compressor de Ar C-101</option>
                  <option value="2">Forno Industrial F-01</option>
                  <option value="3">Esteira Transportadora E-22</option>
                  <option value="4">Prensa Hidráulica P-05</option>
                </select>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                    <label for="pmFrequency" class="form-label">Frequência</label>
                    <input type="number" class="form-control" id="pmFrequency" placeholder="Ex: 30" required>
                </div>
                <div class="col-md-6">
                    <label for="pmFrequencyUnit" class="form-label">Unidade de Frequência</label>
                    <select class="form-select" id="pmFrequencyUnit" required>
                        <option value="days">Dias</option>
                        <option value="weeks">Semanas</option>
                        <option value="months">Meses</option>
                    </select>
                </div>
              </div>
              <hr class="my-4">
              <div class="row g-3 align-items-end">
                <div class="col-md-6">
                    <label for="pmStartDate" class="form-label">Data de Início do Plano (ou Última Execução)</label>
                    <input type="date" class="form-control" id="pmStartDate" required>
                </div>
                <div class="col-md-6">
                    <p class="mb-1 small text-muted">Próximo Vencimento Calculado:</p>
                    <p class="h5" id="nextDueDateDisplay">-</p>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary" form="pm-form"><i class="bi bi-check-circle me-2"></i>Salvar Plano</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Confirmação de Ativar/Desativar -->
    <div class="modal fade" id="toggleStatusModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="toggleStatusModalLabel">Confirmar Alteração de Status</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="toggleStatusModalBody">
            <!-- Conteúdo dinâmico -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="confirmToggleBtn">Confirmar</button>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const createPmModal = new bootstrap.Modal(document.getElementById('createPmModal'));
            const toggleStatusModal = new bootstrap.Modal(document.getElementById('toggleStatusModal'));
            const pmForm = document.getElementById('pm-form');
            const pmTableBody = document.getElementById('pm-table-body');
            const confirmToggleBtn = document.getElementById('confirmToggleBtn');
            let planIdToToggle = null;

            // Função para verificar status de vencimento
            function checkDueDates() {
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                document.querySelectorAll('#pm-table-body tr').forEach(row => {
                    const isActive = row.dataset.isActive === 'true';
                    if (!isActive) return; // Não verifica vencimento para inativos

                    const dueDateCell = row.querySelector('.due-date');
                    const dueDate = new Date(dueDateCell.dataset.dueDate + 'T00:00:00-03:00');
                    const statusBadge = row.querySelector('.status-badge .badge');

                    if (dueDate < today) {
                        dueDateCell.classList.add('status-vencido');
                        dueDateCell.classList.remove('status-ok');
                        statusBadge.classList.remove('bg-success');
                        statusBadge.classList.add('bg-danger');
                        statusBadge.textContent = 'Vencido';
                    } else {
                        dueDateCell.classList.remove('status-vencido');
                        statusBadge.classList.remove('bg-danger');
                        statusBadge.classList.add('bg-success');
                        statusBadge.textContent = 'Ativo';
                    }
                });
            }

            // Função para calcular próxima data no modal
            function setupModalCalculator() {
                const modal = document.getElementById('createPmModal');
                const frequencyInput = modal.querySelector('#pmFrequency');
                const unitInput = modal.querySelector('#pmFrequencyUnit');
                const startDateInput = modal.querySelector('#pmStartDate');
                const dueDateDisplay = modal.querySelector('#nextDueDateDisplay');

                function calculateNextDueDate() {
                    const frequency = parseInt(frequencyInput.value);
                    const unit = unitInput.value;
                    const startDate = startDateInput.value;

                    if (!frequency || !unit || !startDate) {
                        dueDateDisplay.textContent = '-';
                        return;
                    }

                    const date = new Date(startDate + 'T00:00:00-03:00');
                    if (isNaN(date.getTime())) return;

                    if (unit === 'days') date.setDate(date.getDate() + frequency);
                    else if (unit === 'weeks') date.setDate(date.getDate() + frequency * 7);
                    else if (unit === 'months') date.setMonth(date.getMonth() + frequency);

                    dueDateDisplay.textContent = date.toLocaleDateString('pt-BR');
                }

                [frequencyInput, unitInput, startDateInput].forEach(el => el.addEventListener('input', calculateNextDueDate));
            }
            
            // Lógica para abrir modal de edição ou criação
            function openPmModal(planData = null) {
                pmForm.reset();
                const modalLabel = document.getElementById('createPmModalLabel');
                const planIdInput = document.getElementById('pmPlanId');

                if (planData) { // Modo Edição
                    modalLabel.textContent = 'Editar Plano de Manutenção Preventiva';
                    planIdInput.value = planData.planId;
                    document.getElementById('pmTitle').value = planData.title;
                    document.getElementById('pmAsset').value = planData.assetId;
                    document.getElementById('pmFrequency').value = planData.frequency;
                    document.getElementById('pmFrequencyUnit').value = planData.frequencyUnit;
                    document.getElementById('pmStartDate').value = planData.startDate;
                } else { // Modo Criação
                    modalLabel.textContent = 'Criar Novo Plano de Manutenção Preventiva';
                    planIdInput.value = '';
                }
                
                // Trigger calculation
                pmForm.querySelector('#pmFrequency').dispatchEvent(new Event('input'));
                createPmModal.show();
            }

            // Lógica para abrir modal de confirmação de status
            function openToggleStatusModal(planId, planTitle, isActive) {
                planIdToToggle = planId;
                const actionText = isActive ? 'desativar' : 'ativar';
                const modalBody = document.getElementById('toggleStatusModalBody');
                modalBody.innerHTML = `Você tem certeza que deseja <strong>${actionText}</strong> o plano de manutenção para <strong>"${planTitle}"</strong>?`;
                toggleStatusModal.show();
            }

            // Event Listeners
            document.getElementById('createNewPmBtn').addEventListener('click', () => openPmModal());

            pmTableBody.addEventListener('click', function(e) {
                const target = e.target.closest('button');
                if (!target) return;

                const row = target.closest('tr');
                const planData = {
                    planId: row.dataset.planId,
                    title: row.dataset.title,
                    assetId: row.dataset.assetId,
                    frequency: row.dataset.frequency,
                    frequencyUnit: row.dataset.frequencyUnit,
                    startDate: row.dataset.startDate,
                    isActive: row.dataset.isActive === 'true'
                };

                if (target.classList.contains('edit-btn')) {
                    openPmModal(planData);
                }
                if (target.classList.contains('toggle-status-btn')) {
                    openToggleStatusModal(planData.planId, planData.title, planData.isActive);
                }
            });

            confirmToggleBtn.addEventListener('click', function() {
                const row = pmTableBody.querySelector(`tr[data-plan-id="${planIdToToggle}"]`);
                if (!row) return;

                const isActive = row.dataset.isActive === 'true';
                const newStatus = !isActive;
                const statusBadge = row.querySelector('.status-badge');
                const toggleBtn = row.querySelector('.toggle-status-btn');
                const toggleIcon = toggleBtn.querySelector('i');

                row.dataset.isActive = newStatus;
                row.classList.toggle('inactive', !newStatus);
                
                if(newStatus) { // Ativando
                    statusBadge.innerHTML = '<span class="badge bg-success">Ativo</span>';
                    toggleBtn.classList.remove('btn-outline-success');
                    toggleBtn.classList.add('btn-outline-danger');
                    toggleBtn.title = 'Desativar';
                    toggleIcon.classList.remove('bi-toggle-on');
                    toggleIcon.classList.add('bi-toggle-off');
                } else { // Desativando
                    statusBadge.innerHTML = '<span class="badge bg-secondary">Inativo</span>';
                    toggleBtn.classList.remove('btn-outline-danger');
                    toggleBtn.classList.add('btn-outline-success');
                    toggleBtn.title = 'Ativar';
                    toggleIcon.classList.remove('bi-toggle-off');
                    toggleIcon.classList.add('bi-toggle-on');
                }
                
                checkDueDates();
                toggleStatusModal.hide();
            });
            
            pmForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const planId = document.getElementById('pmPlanId').value;
                const message = planId ? 'Plano atualizado com sucesso!' : 'Plano criado com sucesso!';
                alert(message + ' (Protótipo)');
                createPmModal.hide();
            });

            // Inicialização
            checkDueDates();
            setupModalCalculator();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Ativos - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.025);
        }
        .nav-link.active {
            font-weight: 600;
        }
        .criticidade-dot {
            height: 12px;
            width: 12px;
            border-radius: 50%;
            display: inline-block;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="pm_management_list.html">Manutenção Preventiva</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="asset_management_list.html">Ativos</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">Gestão de Ativos</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#assetModal">
                <i class="bi bi-plus-circle-fill me-2"></i>Adicionar Novo Ativo
            </button>
        </div>

        <!-- Filtros e Busca -->
        <div class="card mb-4">
            <div class="card-body">
                <form class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label for="searchAsset" class="form-label">Buscar por Ativo</label>
                        <input type="text" class="form-control" id="searchAsset" placeholder="Digite o nome ou tag do ativo...">
                    </div>
                    <div class="col-md-3">
                        <label for="locationFilter" class="form-label">Localização</label>
                        <select id="locationFilter" class="form-select">
                            <option selected>Todas as Localizações</option>
                            <option value="1">Prédio A, Sala 101</option>
                            <option value="2">Ala Norte - Produção</option>
                            <option value="3">Armazém Central</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="criticismFilter" class="form-label">Criticidade</label>
                         <select id="criticismFilter" class="form-select">
                            <option selected>Todos os Níveis</option>
                            <option value="5">5 (Crítico)</option>
                            <option value="4">4 (Alto)</option>
                            <option value="3">3 (Médio)</option>
                            <option value="2">2 (Baixo)</option>
                            <option value="1">1 (Mínimo)</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-secondary w-100"><i class="bi bi-filter me-2"></i>Filtrar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabela de Ativos -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Nome do Ativo</th>
                                <th scope="col">Tag</th>
                                <th scope="col">Localização</th>
                                <th scope="col" class="text-center">Criticidade</th>
                                <th scope="col" class="text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="fw-bold">Compressor de Ar C-101</td>
                                <td><code>COMP-00101</code></td>
                                <td>Ala Norte - Produção</td>
                                <td class="text-center"><span class="criticidade-dot bg-danger me-2" title="5 - Crítico"></span> 5</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes">
                                        <i class="bi bi-eye-fill"></i> Detalhes
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Forno Industrial F-01</td>
                                <td><code>FORN-0001</code></td>
                                <td>Prédio A, Sala 101</td>
                                <td class="text-center"><span class="criticidade-dot bg-danger me-2" title="5 - Crítico"></span> 5</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes">
                                        <i class="bi bi-eye-fill"></i> Detalhes
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Esteira Transportadora E-22</td>
                                <td><code>EST-0022</code></td>
                                <td>Ala Norte - Produção</td>
                                <td class="text-center"><span class="criticidade-dot bg-warning me-2" title="3 - Médio"></span> 3</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes">
                                        <i class="bi bi-eye-fill"></i> Detalhes
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Empilhadeira Elétrica E-03</td>
                                <td><code>EMP-0003</code></td>
                                <td>Armazém Central</td>
                                <td class="text-center"><span class="criticidade-dot bg-success me-2" title="2 - Baixo"></span> 2</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes">
                                        <i class="bi bi-eye-fill"></i> Detalhes
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal: Adicionar/Editar Ativo -->
    <div class="modal fade" id="assetModal" tabindex="-1" aria-labelledby="assetModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="assetModalLabel">Adicionar Novo Ativo</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="asset-form">
              <div class="mb-3">
                <label for="assetName" class="form-label">Nome do Ativo</label>
                <input type="text" class="form-control" id="assetName" placeholder="Ex: Bomba Hidráulica B-52" required>
              </div>

              <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label for="assetTag" class="form-label">Tag do Ativo (Código)</label>
                    <input type="text" class="form-control" id="assetTag" placeholder="Ex: BOMBA-0052" required>
                </div>
                <div class="col-md-6">
                     <label for="assetLocation" class="form-label">Localização</label>
                    <select class="form-select" id="assetLocation" required>
                      <option value="" disabled selected>Selecione a localização...</option>
                      <option value="1">Prédio A, Sala 101</option>
                      <option value="2">Ala Norte - Produção</option>
                      <option value="3">Armazém Central</option>
                    </select>
                </div>
              </div>

              <div class="mb-3">
                <label class="form-label d-block">Nível de Criticidade</label>
                <div class="btn-group w-100" role="group">
                  <input type="radio" class="btn-check" name="criticism" id="c1" value="1"><label class="btn btn-outline-secondary" for="c1">1</label>
                  <input type="radio" class="btn-check" name="criticism" id="c2" value="2"><label class="btn btn-outline-success" for="c2">2</label>
                  <input type="radio" class="btn-check" name="criticism" id="c3" value="3" checked><label class="btn btn-outline-warning" for="c3">3</label>
                  <input type="radio" class="btn-check" name="criticism" id="c4" value="4"><label class="btn btn-outline-primary" for="c4">4</label>
                  <input type="radio" class="btn-check" name="criticism" id="c5" value="5"><label class="btn btn-outline-danger" for="c5">5</label>
                </div>
                <div class="form-text">O nível de criticidade (1=Mínimo, 5=Crítico) define a prioridade padrão das manutenções para este ativo.</div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary" form="asset-form"><i class="bi bi-check-circle me-2"></i>Salvar Ativo</button>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Simula o envio do formulário do modal
            const assetForm = document.getElementById('asset-form');
            assetForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const assetModal = bootstrap.Modal.getInstance(document.getElementById('assetModal'));
                assetModal.hide();
                alert('Ativo salvo com sucesso! (Protótipo)');
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Ativo: Compressor C-101 - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.05);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .nav-link.active {
            font-weight: 600;
        }
        .nav-tabs .nav-link {
            color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
            background-color: #f8f9fa;
            border-bottom-color: #f8f9fa;
        }
        .table-hover tbody tr:hover {
            background-color: rgba(0,0,0,0.025);
        }
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
        }
        .gallery-item img {
            transition: transform 0.3s ease;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-light">

    <!-- Barra de Navegação Padrão -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="ticket_management.html">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="pm_management_list.html">Manutenção Preventiva</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="asset_management_list.html">Ativos</a></li>
                </ul>
                <div class="d-flex text-white align-items-center">
                     <span class="navbar-text me-3"><i class="bi bi-person-circle me-1"></i> Olá, Maria Almeida (Gerente)</span>
                     <button class="btn btn-outline-light btn-sm" type="button">Sair</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container my-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="h2 mb-0">Compressor de Ar C-101</h1>
                <p class="text-muted mb-0">Tag: <code>COMP-00101</code></p>
            </div>
            <a href="asset_management_list.html" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Voltar para a Lista de Ativos
            </a>
        </div>

        <div class="row">
            <!-- Coluna de Informações Gerais e Ações -->
            <div class="col-lg-4 mb-4">
                <div class="card position-sticky" style="top: 1rem;">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Informações Gerais</h5>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Localização:</strong> Ala Norte - Produção</li>
                        <li class="list-group-item">
                            <strong>Criticidade:</strong> 
                            <span class="badge bg-danger">5 - Crítico</span>
                        </li>
                         <li class="list-group-item"><strong>Status Operacional:</strong> <span class="badge bg-success">Em Operação</span></li>
                    </ul>
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">Ações Rápidas</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary"><i class="bi bi-plus-circle me-2"></i>Criar OS para este Ativo</button>
                            <button class="btn btn-secondary"><i class="bi bi-pencil-square me-2"></i>Editar Ativo</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coluna de Detalhes com Abas -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                         <ul class="nav nav-tabs card-header-tabs" id="asset-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">Histórico de Manutenção</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="pm-tab" data-bs-toggle="tab" data-bs-target="#pm" type="button" role="tab">Planos de PM</button>
                            </li>
                             <li class="nav-item" role="presentation">
                                <button class="nav-link" id="costs-tab" data-bs-toggle="tab" data-bs-target="#costs" type="button" role="tab">Análise de Custos</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="gallery-tab" data-bs-toggle="tab" data-bs-target="#gallery" type="button" role="tab">Galeria</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="asset-tabs-content">
                            <!-- Aba de Histórico de Manutenção -->
                            <div class="tab-pane fade show active" id="history" role="tabpanel">
                                <h5 class="mb-3">Ordens de Serviço Realizadas</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>OS</th>
                                                <th>Título</th>
                                                <th>Status</th>
                                                <th>Data Conclusão</th>
                                                <th>Técnico</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><a href="work_order_detail.html">OS-122</a></td>
                                                <td>Troca de filtro e óleo</td>
                                                <td><span class="badge bg-success">Concluída</span></td>
                                                <td>10/10/2025</td>
                                                <td>João Silva</td>
                                            </tr>
                                            <tr>
                                                <td><a href="work_order_detail.html">OS-115</a></td>
                                                <td>Reparo de vazamento de ar</td>
                                                <td><span class="badge bg-success">Concluída</span></td>
                                                <td>01/09/2025</td>
                                                <td>Ana Souza</td>
                                            </tr>
                                            <tr>
                                                <td><a href="work_order_detail.html">OS-098</a></td>
                                                <td>Verificar ruído anormal no motor</td>
                                                <td><span class="badge bg-success">Concluída</span></td>
                                                <td>15/07/2025</td>
                                                <td>João Silva</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Aba de Planos de PM -->
                            <div class="tab-pane fade" id="pm" role="tabpanel">
                                 <h5 class="mb-3">Planos de Manutenção Preventiva Associados</h5>
                                 <ul class="list-group">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Inspeção e Limpeza de Filtros</h6>
                                            <small>Frequência: A cada 30 dias</small>
                                        </div>
                                        <span class="badge bg-danger rounded-pill">Vencido</span>
                                    </li>
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Análise de Vibração do Motor</h6>
                                            <small>Frequência: A cada 90 dias</small>
                                        </div>
                                        <span class="badge bg-success rounded-pill">Em dia</span>
                                    </li>
                                </ul>
                            </div>
                             <!-- Aba de Análise de Custos -->
                            <div class="tab-pane fade" id="costs" role="tabpanel">
                                <h5 class="mb-3">Custo de Manutenção com Peças (Últimos 6 meses)</h5>
                                <div>
                                    <canvas id="costsChart"></canvas>
                                </div>
                            </div>
                            <!-- Aba de Galeria -->
                            <div class="tab-pane fade" id="gallery" role="tabpanel">
                                <h5 class="mb-3">Galeria de Fotos de Manutenções</h5>
                                <div class="row g-2">
                                    <div class="col-md-4">
                                        <a href="#" class="gallery-item">
                                            <img src="https://placehold.co/400x300/e9ecef/495057?text=Vazamento+OS-115" class="img-fluid" alt="Foto de vazamento">
                                        </a>
                                    </div>
                                    <div class="col-md-4">
                                         <a href="#" class="gallery-item">
                                            <img src="https://placehold.co/400x300/e9ecef/495057?text=Filtro+OS-122" class="img-fluid" alt="Foto de filtro">
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="container text-center mt-5 mb-3 text-muted">
        <p>&copy; 2025 CMMS Protótipo. Todos os direitos reservados.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const costsChartCanvas = document.getElementById('costsChart');
            const costsTab = document.getElementById('costs-tab');
            let costsChart;

            // Renderiza o gráfico apenas quando a aba é exibida pela primeira vez
            // para evitar problemas de dimensionamento.
            costsTab.addEventListener('shown.bs.tab', event => {
                if (costsChart) return;

                costsChart = new Chart(costsChartCanvas, {
                    type: 'bar',
                    data: {
                        labels: ['Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out'],
                        datasets: [{
                            label: 'Custo com Peças (R$)',
                            data: [150.75, 80.20, 320.50, 50.00, 255.40, 450.90],
                            backgroundColor: 'rgba(13, 110, 253, 0.6)',
                            borderColor: 'rgba(13, 110, 253, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value;
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Custo: R$ ${context.raw.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário de Manutenções - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- FullCalendar CSS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core/locales/pt-br.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .nav-link.active {
            font-weight: 600;
            color: #fff !important;
        }
        
        /* Estilos customizados para o FullCalendar */
        #calendar-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        #calendar {
            flex: 1 1 600px; /* Permite que o calendário cresça e encolha */
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }
        #calendar-sidebar {
            flex: 1 1 300px; /* Sidebar flexível */
            min-width: 300px;
        }
        .fc .fc-toolbar-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .fc-event {
            cursor: pointer;
            border: none !important;
            padding: 5px 8px;
            font-size: 0.85em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .fc-event .bi {
            margin-right: 5px;
        }
    </style>
</head>
<body>

    <!-- Navegação Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Calendário</a></li>
                </ul>
                <div class="d-flex align-items-center">
                    <a href="ticket_create.html" class="btn btn-primary me-3"><i class="bi bi-plus-circle-fill me-1"></i> Criar Ticket</a>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-4 me-2"></i>
                            <div><div class="fw-bold">Maria Almeida</div><small class="text-muted">Gerente</small></div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="dropdownUser">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person-fill me-2"></i> Perfil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2">Calendário de Manutenções</h1>
            <a href="work_order_detail.html" class="btn btn-primary">
                <i class="bi bi-plus-circle-fill me-1"></i> Nova Ordem de Serviço
            </a>
        </div>

        <div id="calendar-container">
            <!-- FullCalendar -->
            <div id='calendar'></div>
            
            <!-- Sidebar -->
            <aside id="calendar-sidebar">
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-palette-fill me-2"></i>Legenda de Status</h5>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><span class="badge bg-primary me-2">&nbsp;</span> Manutenção Preventiva</li>
                        <li class="list-group-item"><span class="badge bg-success me-2">&nbsp;</span> OS Aberta / Agendada</li>
                        <li class="list-group-item"><span class="badge bg-info text-dark me-2">&nbsp;</span> OS Em Progresso</li>
                        <li class="list-group-item"><span class="badge bg-warning text-dark me-2">&nbsp;</span> Aguardando Aprovação</li>
                        <li class="list-group-item"><span class="badge bg-danger me-2">&nbsp;</span> Atrasada / Vencida</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-list-task me-2"></i>Tarefas de Hoje (16/10/2025)</h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="work_order_detail.html" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 text-info">OS: Falha no sensor</h6>
                                <small><i class="bi bi-clock"></i> 15:30</small>
                            </div>
                            <p class="mb-1 small text-muted">Ativo: Compressor de Ar C-101</p>
                        </a>
                         <a href="#" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1 text-warning">OS: Vazamento na Prensa</h6>
                                <small><i class="bi bi-clock"></i> Dia todo</small>
                            </div>
                            <p class="mb-1 small text-muted">Ativo: Prensa Hidráulica P-05</p>
                        </a>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Modal para Detalhes do Evento -->
    <div class="modal fade" id="eventDetailModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" id="modalHeader">
            <h5 class="modal-title" id="modalTitle"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><i class="bi bi-gear-fill text-muted me-2"></i><strong>Ativo:</strong> <span id="modalAsset"></span></p>
            <p><i class="bi bi-clipboard-check-fill text-muted me-2"></i><strong>Status:</strong> <span id="modalStatus"></span></p>
            <p><i class="bi bi-person-fill text-muted me-2"></i><strong>Atribuído a:</strong> <span id="modalAssignedTo"></span></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            <a href="work_order_detail.html" class="btn btn-primary"><i class="bi bi-eye-fill me-2"></i>Ver Detalhes</a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            const eventDetailModal = new bootstrap.Modal(document.getElementById('eventDetailModal'));

            // Dados Fictícios de Ordens de Serviço e Manutenções Preventivas
            const mockEvents = [
                // WorkOrder em Progresso (Iniciada hoje)
                {
                    title: 'OS: Falha no sensor',
                    start: '2025-10-16T15:30:00',
                    className: 'bg-info text-dark',
                    extendedProps: {
                        status: 'Em Progresso',
                        asset: 'Compressor de Ar C-101',
                        assignedTo: 'João Silva'
                    }
                },
                // WorkOrder Aguardando Aprovação
                {
                    title: 'OS: Vazamento na Prensa',
                    start: '2025-10-16',
                    allDay: true,
                    className: 'bg-warning text-dark',
                    extendedProps: {
                        status: 'Aguardando Aprovação',
                        asset: 'Prensa Hidráulica P-05',
                        assignedTo: 'Não atribuído'
                    }
                },
                // PM Agendada
                {
                    title: 'PM: Lubrificação da Esteira',
                    start: '2025-10-20',
                    allDay: true,
                    className: 'bg-primary',
                    extendedProps: {
                        status: 'Manutenção Preventiva',
                        asset: 'Esteira E-22',
                        assignedTo: 'Equipe de Manutenção'
                    }
                },
                // WorkOrder Aberta e Agendada
                 {
                    title: 'OS: Troca de rolamento',
                    start: '2025-10-22T09:00:00',
                    end: '2025-10-22T12:00:00',
                    className: 'bg-success',
                    extendedProps: {
                        status: 'Aberta',
                        asset: 'Motor Elétrico M-08',
                        assignedTo: 'Ana Souza'
                    }
                },
                // PM Atrasada
                {
                    title: 'PM: Inspeção de segurança',
                    start: '2025-10-10',
                    allDay: true,
                    className: 'bg-danger',
                    extendedProps: {
                        status: 'Atrasada',
                        asset: 'Painel Elétrico Principal',
                        assignedTo: 'Equipe de Elétrica'
                    }
                }
            ];

            const calendar = new FullCalendar.Calendar(calendarEl, {
                locale: 'pt-br',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                initialDate: '2025-10-16', // Data de hoje para o protótipo
                initialView: 'dayGridMonth',
                navLinks: true, 
                editable: false, // Protótipo não permite arrastar/soltar
                dayMaxEvents: true,
                events: mockEvents,
                eventContent: function(arg) {
                    let iconHtml = '';
                    // Mapeia o status para um ícone
                    switch (arg.event.extendedProps.status) {
                        case 'Manutenção Preventiva': iconHtml = '<i class="bi bi-shield-check"></i>'; break;
                        case 'Aberta': iconHtml = '<i class="bi bi-calendar-check"></i>'; break;
                        case 'Em Progresso': iconHtml = '<i class="bi bi-gear"></i>'; break;
                        case 'Aguardando Aprovação': iconHtml = '<i class="bi bi-patch-question"></i>'; break;
                        case 'Atrasada': iconHtml = '<i class="bi bi-exclamation-triangle"></i>'; break;
                        default: iconHtml = '<i class="bi bi-info-circle"></i>'; break;
                    }
                    return { html: `<div>${iconHtml} ${arg.event.title}</div>` };
                },
                eventClick: function(info) {
                    // Preenche e exibe o modal com os dados do evento clicado
                    const modalHeader = document.getElementById('modalHeader');
                    document.getElementById('modalTitle').textContent = info.event.title;
                    document.getElementById('modalAsset').textContent = info.event.extendedProps.asset;
                    document.getElementById('modalStatus').textContent = info.event.extendedProps.status;
                    document.getElementById('modalAssignedTo').textContent = info.event.extendedProps.assignedTo;

                    // Ajusta a cor do cabeçalho do modal
                    modalHeader.className = 'modal-header text-white';
                    info.event.classNames.forEach(className => {
                        if (className.startsWith('bg-')) {
                            modalHeader.classList.add(className);
                        }
                    });

                    eventDetailModal.show();
                }
            });

            calendar.render();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Usuários - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .nav-link.active {
            font-weight: 600;
            color: #fff !important;
        }
        .table thead {
            background-color: #e9ecef;
        }
        .badge {
            font-weight: 600;
            padding: 0.4em 0.7em;
            font-size: 0.8rem;
        }
        .action-btn {
            width: 35px;
            height: 35px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <!-- Navegação Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="dashboard.html"><i class="bi bi-tools me-2"></i>CMMS Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Tickets</a></li>
                    <li class="nav-item"><a class="nav-link" href="pm_schedule_list.html">Calendário</a></li>
                </ul>
                <div class="d-flex align-items-center">
                    <a href="ticket_create.html" class="btn btn-primary me-3"><i class="bi bi-plus-circle-fill me-1"></i> Criar Ticket</a>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items: center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-4 me-2"></i>
                            <div><div class="fw-bold">Maria Almeida</div><small class="text-muted">Gerente</small></div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="dropdownUser">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear-fill me-2"></i> Configurações</a></li>
                            <li><a class="dropdown-item" href="user_management.html"><i class="bi bi-people-fill me-2"></i> Gestão de Usuários</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2">Gestão de Usuários</h1>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userModal" id="addUserBtn">
                <i class="bi bi-plus-circle-fill me-2"></i>Adicionar Novo Usuário
            </button>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th scope="col">Nome Completo</th>
                                <th scope="col">E-mail</th>
                                <th scope="col">Função</th>
                                <th scope="col" class="text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados Fictícios baseados no modelo User -->
                            <tr>
                                <td><strong>Maria Almeida</strong></td>
                                <td>maria.almeida@email.com</td>
                                <td><span class="badge bg-primary">Gerente</span></td>
                                <td class="text-center">
                                    <button class="btn btn-outline-secondary btn-sm action-btn edit-user" title="Editar Usuário"
                                        data-bs-toggle="modal" data-bs-target="#userModal"
                                        data-id="1" data-name="Maria Almeida" data-email="maria.almeida@email.com" data-role="manager">
                                        <i class="bi bi-pencil-fill"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>João Silva</strong></td>
                                <td>joao.silva@email.com</td>
                                <td><span class="badge bg-info text-dark">Técnico</span></td>
                                <td class="text-center">
                                    <button class="btn btn-outline-secondary btn-sm action-btn edit-user" title="Editar Usuário"
                                        data-bs-toggle="modal" data-bs-target="#userModal"
                                        data-id="2" data-name="João Silva" data-email="joao.silva@email.com" data-role="technician">
                                        <i class="bi bi-pencil-fill"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm action-btn" title="Desativar Usuário"><i class="bi bi-trash-fill"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Ana Souza</strong></td>
                                <td>ana.souza@email.com</td>
                                <td><span class="badge bg-info text-dark">Técnico</span></td>
                                <td class="text-center">
                                     <button class="btn btn-outline-secondary btn-sm action-btn edit-user" title="Editar Usuário"
                                        data-bs-toggle="modal" data-bs-target="#userModal"
                                        data-id="3" data-name="Ana Souza" data-email="ana.souza@email.com" data-role="technician">
                                        <i class="bi bi-pencil-fill"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm action-btn" title="Desativar Usuário"><i class="bi bi-trash-fill"></i></button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Roberto Andrade</strong></td>
                                <td>roberto.andrade@email.com</td>
                                <td><span class="badge bg-secondary">Solicitante</span></td>
                                <td class="text-center">
                                     <button class="btn btn-outline-secondary btn-sm action-btn edit-user" title="Editar Usuário"
                                        data-bs-toggle="modal" data-bs-target="#userModal"
                                        data-id="4" data-name="Roberto Andrade" data-email="roberto.andrade@email.com" data-role="requester">
                                        <i class="bi bi-pencil-fill"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm action-btn" title="Desativar Usuário"><i class="bi bi-trash-fill"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Adicionar/Editar Usuário -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">Adicionar Novo Usuário</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <input type="hidden" id="userId" name="id">
                        <div class="mb-3">
                            <label for="userFullName" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="userFullName" name="full_name" required>
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="userEmail" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="userRole" class="form-label">Função / Permissão</label>
                            <select class="form-select" id="userRole" name="role" required>
                                <!-- Opções baseadas em all-models.py -> User.ROLE_CHOICES -->
                                <option value="requester">Solicitante</option>
                                <option value="technician">Técnico</option>
                                <option value="manager">Gerente</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" form="userForm" class="btn btn-primary">Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userModal = document.getElementById('userModal');
            const modalTitle = document.getElementById('userModalLabel');
            const userForm = document.getElementById('userForm');
            const userIdField = document.getElementById('userId');
            const userNameField = document.getElementById('userFullName');
            const userEmailField = document.getElementById('userEmail');
            const userRoleField = document.getElementById('userRole');

            // Limpa o formulário ao clicar em 'Adicionar Novo Usuário'
            document.getElementById('addUserBtn').addEventListener('click', function() {
                modalTitle.textContent = 'Adicionar Novo Usuário';
                userForm.reset();
                userIdField.value = '';
            });

            // Preenche o formulário ao clicar em 'Editar'
            document.querySelectorAll('.edit-user').forEach(button => {
                button.addEventListener('click', function() {
                    modalTitle.textContent = 'Editar Usuário';
                    
                    const userId = this.dataset.id;
                    const userName = this.dataset.name;
                    const userEmail = this.dataset.email;
                    const userRole = this.dataset.role;

                    userIdField.value = userId;
                    userNameField.value = userName;
                    userEmailField.value = userEmail;
                    userRoleField.value = userRole;
                });
            });
        });
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abrir Chamado Rápido - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Um cinza levemente azulado */
        }
        .main-container {
            max-width: 500px;
        }
        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 8px 24px rgba(0,0,0,.1);
        }
        .machine-header h1 {
            font-weight: 700;
            color: #0d6efd; /* Azul do Bootstrap */
        }
        
        /* Estilos do botão de gravação */
        #record-button {
            width: 90px;
            height: 90px;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        #record-button.recording {
            background-color: #dc3545; /* Vermelho do Bootstrap */
            transform: scale(1.1);
            animation: pulse 1.5s infinite;
        }
        #record-icon {
            font-size: 2.5rem;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        .form-label {
            font-weight: 600;
        }
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            border-color: #86b7fe;
        }
        #ai-spinner {
            width: 2.5rem;
            height: 2.5rem;
        }
    </style>
</head>
<body>

    <main class="container main-container p-3 p-md-4">
        
        <!-- Cabeçalho com o nome do Ativo -->
        <header class="text-center my-4 machine-header">
            <p id="header-subtitle" class="text-muted mb-1">Abertura de chamado para o ativo:</p>
            <h1 id="asset-name" class="h2">Carregando...</h1>
            <p id="asset-id-display" class="text-muted small"></p>
        </header>

        <!-- Seção de Seleção de Ativo (visível se não houver ID na URL) -->
        <div id="asset-selection-section" class="d-none">
            <div class="card mb-4">
                <div class="card-body p-4">
                    <label for="asset-select" class="form-label fs-5 mb-3">1. Selecione o Ativo</label>
                    <select class="form-select form-select-lg" id="asset-select">
                        <option selected disabled value="">Escolha um equipamento...</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body p-4 p-lg-5">
                <form id="ticket-form">
                    <!-- 1. Seção da IA com Gravação de Voz -->
                    <div class="text-center mb-4">
                        <label id="voice-step-label" class="form-label fs-5 mb-3">Descreva o problema</label>
                        <p id="ai-status-text" class="text-muted mb-3">Segure o botão abaixo para gravar o problema com sua voz.</p>
                        
                        <button type="button" id="record-button" class="btn btn-success rounded-circle d-flex align-items-center justify-content-center mx-auto">
                            <i id="record-icon" class="bi bi-mic-fill text-white"></i>
                            <div id="ai-spinner" class="spinner-border text-light d-none" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </button>
                        
                        <div id="transcribed-text-container" class="form-text mt-3 fst-italic d-none"></div>
                        <div id="ai-error" class="alert alert-danger p-2 mt-3 d-none"></div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <!-- 2. Campos do Formulário (preenchidos pela IA) -->
                    <div id="details-section">
                        <h4 id="review-step-label" class="mb-3 fs-5 text-center">Revise as informações</h4>
                        <div class="mb-3">
                            <label for="ticket-title" class="form-label">Título do Problema</label>
                            <input type="text" class="form-control" id="ticket-title" name="title" placeholder="Aguardando análise da IA..." required>
                        </div>
                        <div class="mb-3">
                            <label for="ticket-description" class="form-label">Descrição Detalhada</label>
                            <textarea class="form-control" id="ticket-description" name="description" rows="5" placeholder="Aguardando análise da IA..." required></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="ticket-files" class="form-label">Anexar Foto (Opcional)</label>
                            <input class="form-control" type="file" id="ticket-files" accept="image/*" capture="environment">
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" id="submit-button" class="btn btn-primary btn-lg">
                                <i class="bi bi-send-fill me-2"></i>Enviar Ticket
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Mensagem de status (sucesso/erro) -->
        <div id="status-message" class="mt-4"></div>

    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- Elementos do DOM ---
        const headerSubtitle = document.getElementById('header-subtitle');
        const assetNameEl = document.getElementById('asset-name');
        const assetIdDisplayEl = document.getElementById('asset-id-display');
        const assetSelectionSection = document.getElementById('asset-selection-section');
        const assetSelect = document.getElementById('asset-select');
        const voiceStepLabel = document.getElementById('voice-step-label');
        const reviewStepLabel = document.getElementById('review-step-label');
        const recordButton = document.getElementById('record-button');
        const recordIcon = document.getElementById('record-icon');
        const aiSpinner = document.getElementById('ai-spinner');
        const aiStatusText = document.getElementById('ai-status-text');
        const transcribedContainer = document.getElementById('transcribed-text-container');
        const aiErrorEl = document.getElementById('ai-error');
        const titleInput = document.getElementById('ticket-title');
        const descriptionInput = document.getElementById('ticket-description');
        const form = document.getElementById('ticket-form');
        const submitButton = document.getElementById('submit-button');
        const statusMessageEl = document.getElementById('status-message');

        // --- Simulação de Dados e Estado ---
        let assetId = null;
        const mockAssets = {
            'a5a5a5e5-6a5a-1a5a-5a5a-5a5a5a5a5a5a': 'Prensa Hidráulica P-05',
            'b6b6b6e6-7b6b-2b6b-6b6b-6b6b6b6b6b6b': 'Compressor de Ar C-101',
            'c7a7a7e7-8a7a-3a7a-7a7a-7a7a7a7a7a7a': 'Esteira Transportadora E-22',
            'd8b8a8e8-9b8b-4b8b-8b8b-8b8b8b8b8b8b': 'Motor Elétrico M-08'
        };

        // --- Lógica de Reconhecimento de Voz ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'pt-BR';
            recognition.interimResults = false;
        } else {
            handleError("Navegador não suporta gravação de voz.");
            recordButton.disabled = true;
        }

        const startRecording = () => {
            if (!recognition) return;
            resetUIState();
            aiStatusText.textContent = "Ouvindo... Solte para processar.";
            recordButton.classList.add('recording');
            recognition.start();
        };

        const stopRecording = () => {
            if (!recognition) return;
            aiStatusText.textContent = "Processando áudio com a IA...";
            recordButton.classList.remove('recording');
            recordIcon.classList.add('d-none');
            aiSpinner.classList.remove('d-none');
            recognition.stop();
        };

        if (recognition) {
            recordButton.addEventListener('mousedown', startRecording);
            recordButton.addEventListener('mouseup', stopRecording);
            recordButton.addEventListener('touchstart', (e) => { e.preventDefault(); startRecording(); });
            recordButton.addEventListener('touchend', stopRecording);

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                transcribedContainer.textContent = `Você disse: "${transcript}"`;
                transcribedContainer.classList.remove('d-none');
                callGeminiAPI(transcript);
            };
            
            recognition.onerror = (event) => {
                handleError(`Erro na gravação: ${event.error}. Tente novamente.`);
            };
        }

        // --- Lógica da IA (Gemini) ---
        async function callGeminiAPI(userProblem) {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const systemPrompt = `Você é um assistente especialista em manutenção industrial. Sua tarefa é analisar o relato de um operador sobre um problema em um equipamento e extrair as informações essenciais.
                Responda APENAS com um objeto JSON válido, contendo duas chaves:
                1. "title": Um título técnico, curto e objetivo para um ticket de manutenção (máximo 60 caracteres).
                2. "description": Uma descrição detalhada e estruturada do problema, começando com um resumo, depois listando os sintomas observados e, se possível, uma possível causa ou observação adicional.`;

            const payload = {
                contents: [{ parts: [{ text: userProblem }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API retornou status ${response.status}`);
                
                const result = await response.json();
                const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!textResponse) throw new Error("Resposta da IA inválida.");
                
                const jsonResponse = JSON.parse(textResponse.replace(/```json/g, '').replace(/```/g, ''));
                
                titleInput.value = jsonResponse.title;
                descriptionInput.value = jsonResponse.description;
                
                aiStatusText.textContent = "Informações preenchidas! Revise e envie.";

            } catch (error) {
                console.error("Erro na API Gemini:", error);
                handleError("Não foi possível processar com a IA. Por favor, preencha os campos manualmente.");
                titleInput.placeholder = "Descreva o título do problema";
                descriptionInput.placeholder = "Descreva os detalhes do problema";
            } finally {
                recordIcon.classList.remove('d-none');
                aiSpinner.classList.add('d-none');
            }
        }

        // --- Lógica do Formulário e Inicialização ---
        function initializePage() {
            const urlParams = new URLSearchParams(window.location.search);
            let urlAssetId = urlParams.get('asset_id');

            if (urlAssetId && mockAssets[urlAssetId]) {
                // Caso 1: ID válido na URL (Fluxo QRCode)
                assetId = urlAssetId;
                const assetName = mockAssets[assetId];
                assetNameEl.textContent = assetName;
                assetNameEl.style.color = '#198754'; // Verde
                assetIdDisplayEl.textContent = `ID: ${assetId}`;
                headerSubtitle.textContent = 'Abertura de chamado para o ativo:';
            } else {
                // Caso 2: Sem ID na URL (Fluxo Manual)
                assetNameEl.textContent = 'Abrir Chamado Rápido';
                assetIdDisplayEl.classList.add('d-none');
                headerSubtitle.textContent = 'Formulário de Abertura de Ticket';
                
                // Exibe e popula a seleção de ativos
                assetSelectionSection.classList.remove('d-none');
                Object.entries(mockAssets).forEach(([id, name]) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = name;
                    assetSelect.appendChild(option);
                });

                assetSelect.addEventListener('change', (e) => {
                    assetId = e.target.value;
                });

                // Enumera os passos
                voiceStepLabel.textContent = "2. Descreva o problema";
                reviewStepLabel.textContent = "3. Revise as informações";
            }
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!assetId) {
                showStatusMessage('Por favor, selecione um ativo antes de enviar.', 'warning');
                assetSelect.focus();
                return;
            }

            submitButton.disabled = true;
            submitButton.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Enviando...`;
            
            setTimeout(() => {
                const formData = new FormData(form);
                console.log("--- DADOS DO TICKET PARA ENVIO ---");
                console.log("Asset ID:", assetId);
                console.log("Título:", formData.get('title'));
                console.log("Descrição:", formData.get('description'));
                console.log("Arquivo:", document.getElementById('ticket-files').files[0]);
                
                showStatusMessage('Ticket enviado com sucesso! A equipe de manutenção já foi notificada.', 'success');
                form.reset();
                transcribedContainer.classList.add('d-none');
                submitButton.disabled = false;
                submitButton.innerHTML = `<i class="bi bi-send-fill me-2"></i>Enviar Ticket`;
                 setTimeout(() => { statusMessageEl.innerHTML = ''; }, 5000);
            }, 1500);
        });
        
        // --- Funções Auxiliares de UI ---
        function resetUIState() {
            aiErrorEl.classList.add('d-none');
            transcribedContainer.classList.add('d-none');
        }

        function handleError(message) {
            aiErrorEl.textContent = message;
            aiErrorEl.classList.remove('d-none');
            aiStatusText.textContent = "Ocorreu um erro.";
            recordIcon.classList.remove('d-none');
            aiSpinner.classList.add('d-none');
            recordButton.classList.remove('recording');
        }

        function showStatusMessage(message, type = 'success') {
            statusMessageEl.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
        }
        
        // --- Inicializa a página ---
        initializePage();
    });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Produção - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FullCalendar -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e9ecef;
        }
        .portal-header {
            background-color: #198754; /* Verde para diferenciar da Manutenção */
            color: white;
        }
        .nav-tabs .nav-link {
            color: #6c757d;
            border-bottom-width: 4px;
            border-color: transparent;
        }
        .nav-tabs .nav-link.active {
            color: #198754;
            background-color: transparent;
            border-color: #198754;
            font-weight: 600;
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .os-list-item {
            border-left: 5px solid #ffc107; /* Amarelo para pendente */
        }
        .feedback-rating .bi-star-fill,
        #star-rating .bi-star-fill {
            color: #ffc107;
        }
        /* Estilo para itens clicáveis */
        .clickable-ticket {
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Cabeçalho do Portal -->
    <header class="portal-header p-3 shadow-sm">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="bi bi-person-workspace me-2"></i>Portal da Equipe de Produção</h4>
            <div class="d-flex align-items-center">
                <i class="bi bi-person-circle fs-4 me-2"></i>
                <div>
                    <div class="fw-bold">Carlos Pereira</div>
                    <small class="text-muted">Líder de Produção</small>
                </div>
            </div>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-3 p-lg-4">

        <!-- Abas de Navegação -->
        <ul class="nav nav-tabs mb-4" id="productionTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="approval-tab" data-bs-toggle="tab" data-bs-target="#approval-pane" type="button" role="tab">
                    <i class="bi bi-patch-check-fill me-1"></i> Pendentes de Aprovação <span class="badge rounded-pill bg-warning text-dark ms-1">2</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar-pane" type="button" role="tab">
                    <i class="bi bi-calendar-week me-1"></i> Calendário de Paradas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tickets-tab" data-bs-toggle="tab" data-bs-target="#tickets-pane" type="button" role="tab">
                    <i class="bi bi-card-list me-1"></i> Meus Tickets e Feedbacks
                </button>
            </li>
        </ul>

        <!-- Conteúdo das Abas -->
        <div class="tab-content" id="productionTabContent">

            <!-- Pendentes de Aprovação (Aba Padrão) -->
            <div class="tab-pane fade show active" id="approval-pane" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">OS Aguardando Aprovação da Produção</h5>
                        <p class="text-muted">Revise as Ordens de Serviço abaixo para liberar a parada do equipamento para a equipe de manutenção.</p>
                         <div class="list-group">
                            <!-- OS para aprovar 1 -->
                            <div class="list-group-item os-list-item mb-3">
                                <div class="row align-items-center">
                                    <div class="col-md-5">
                                        <h6 class="mb-1 fw-bold">OS-127: Inspeção e lubrificação geral</h6>
                                        <p class="mb-1"><strong>Ativo:</strong> Prensa Hidráulica P-05</p>
                                        <small><strong>Aprovado (Manutenção):</strong> Maria Almeida</small>
                                    </div>
                                    <div class="col-md-5">
                                        <p class="mb-0"><strong>Parada Programada para:</strong></p>
                                        <p class="fw-bold mb-0">20/10/2025 das 14:00 às 16:00 (2h)</p>
                                    </div>
                                    <div class="col-md-2 text-end">
                                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#prodApprovalModal">
                                            <i class="bi bi-check2-circle me-1"></i> Analisar
                                        </button>
                                    </div>
                                </div>
                            </div>
                             <!-- OS para aprovar 2 -->
                            <div class="list-group-item os-list-item">
                                <div class="row align-items-center">
                                    <div class="col-md-5">
                                        <h6 class="mb-1 fw-bold">OS-128: Troca de filtro do sistema de exaustão</h6>
                                        <p class="mb-1"><strong>Ativo:</strong> Forno Industrial F-01</p>
                                        <small><strong>Aprovado (Manutenção):</strong> Maria Almeida</small>
                                    </div>
                                    <div class="col-md-5">
                                        <p class="mb-0"><strong>Parada Programada para:</strong></p>
                                        <p class="fw-bold mb-0">21/10/2025 das 08:00 às 09:00 (1h)</p>
                                    </div>
                                    <div class="col-md-2 text-end">
                                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#prodApprovalModal">
                                            <i class="bi bi-check2-circle me-1"></i> Analisar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calendário de Paradas -->
            <div class="tab-pane fade" id="calendar-pane" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <div id="calendar-prod"></div>
                    </div>
                </div>
            </div>

            <!-- Meus Tickets e Feedbacks -->
            <div class="tab-pane fade" id="tickets-pane" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Tickets Abertos por Você</h5>
                        <div class="list-group">
                             <a href="#" class="list-group-item list-group-item-action clickable-ticket mb-2" data-bs-toggle="modal" data-bs-target="#ticketDetailModal">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Ticket: Painel da IHM não responde</h6>
                                    <span class="badge bg-info text-dark">Pendente</span>
                                </div>
                                <p class="mb-1"><strong>Ativo:</strong> Prensa Hidráulica P-05</p>
                                <small class="text-muted">Aberto em 16/10/2025 - OS-127 gerada</small>
                            </a>
                             <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Ticket: Barulho estranho no motor</h6>
                                     <span class="badge bg-success">Resolvido</span>
                                </div>
                                 <p class="mb-1"><strong>Ativo:</strong> Esteira Transportadora E-22</p>
                                <small class="text-muted">Finalizado em 15/10/2025</small>
                                <hr class="my-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="small">Serviço concluído. Por favor, deixe seu feedback.</span>
                                    <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#feedbackModal">Avaliar Serviço</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Modal de Aprovação de Produção -->
    <div class="modal fade" id="prodApprovalModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Aprovação de Parada de Produção - OS-127</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>Ativo:</strong> Prensa Hidráulica P-05</p>
            <p><strong>Serviço a ser realizado:</strong> Inspeção e lubrificação geral dos componentes principais.</p>
            <p><strong>Data/Hora da Parada:</strong> <span class="fw-bold">20/10/2025 das 14:00 às 16:00</span></p>
            <hr>
            <div class="mb-3">
                <label class="form-label">Comentários (Opcional):</label>
                <textarea class="form-control" rows="3" placeholder="Adicione observações para a equipe de manutenção..."></textarea>
            </div>
            <div class="alert alert-warning small">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>Ao aprovar, você confirma que o equipamento pode ser parado no período solicitado, ciente do impacto na produção.
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i class="bi bi-x-circle me-2"></i>Rejeitar</button>
            <button type="button" class="btn btn-success" data-bs-dismiss="modal"><i class="bi bi-check-lg me-2"></i>Aprovar e Liberar para Manutenção</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal de Feedback -->
    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="feedbackModalLabel">Avaliar Serviço - Ticket: Barulho estranho no motor</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Sua opinião é importante para nós! Por favor, avalie o serviço prestado pela equipe de manutenção.</p>
            <div class="mb-3 text-center">
              <label class="form-label d-block">Sua Avaliação:</label>
              <div id="star-rating" class="fs-2" style="cursor: pointer;">
                <i class="bi bi-star" data-value="1"></i>
                <i class="bi bi-star" data-value="2"></i>
                <i class="bi bi-star" data-value="3"></i>
                <i class="bi bi-star" data-value="4"></i>
                <i class="bi bi-star" data-value="5"></i>
              </div>
              <input type="hidden" id="rating-value" name="rating" value="0">
            </div>
            <div class="mb-3">
              <label for="feedbackComments" class="form-label">Comentários Adicionais (Opcional):</label>
              <textarea class="form-control" id="feedbackComments" rows="4" placeholder="Descreva sua experiência com o serviço..."></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal"><i class="bi bi-send-fill me-2"></i>Enviar Avaliação</button>
          </div>
        </div>
      </div>
    </div>

    <!-- NOVO: Modal de Detalhes do Ticket -->
    <div class="modal fade" id="ticketDetailModal" tabindex="-1" aria-labelledby="ticketDetailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ticketDetailModalLabel">Detalhes do Ticket: Painel da IHM não responde</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
                <div class="col-md-5">
                    <h6><i class="bi bi-info-circle-fill me-2"></i>Informações Gerais</h6>
                    <ul class="list-unstyled">
                        <li><strong>Ativo:</strong> Prensa Hidráulica P-05</li>
                        <li><strong>Status:</strong> <span class="badge bg-info text-dark">Pendente</span></li>
                        <li><strong>Aberto em:</strong> 16/10/2025 por Carlos Pereira</li>
                    </ul>
                     <p><strong>Descrição Original:</strong></p>
                     <p class="text-muted bg-light p-2 rounded">"O painel de controle da prensa P-05 não está respondendo aos comandos de toque na tela. A máquina está operacional via botões físicos, mas a IHM está travada. Reiniciamos o painel mas o problema persiste."</p>
                </div>
                <div class="col-md-7">
                    <h6><i class="bi bi-card-checklist me-2"></i>Ordens de Serviço Vinculadas</h6>
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>OS</th>
                                <th>Título</th>
                                <th>Status</th>
                                <th>Técnico</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a href="#">OS-127</a></td>
                                <td>Inspeção e lubrificação geral</td>
                                <td><span class="badge bg-warning text-dark">Aguardando Aprovação</span></td>
                                <td>Maria Almeida</td>
                            </tr>
                        </tbody>
                    </table>
                    <hr>
                     <h6><i class="bi bi-chat-left-text-fill me-2"></i>Histórico de Comentários</h6>
                     <div class="list-group list-group-flush">
                        <div class="list-group-item">
                            <p class="mb-1"><strong>Maria Almeida (Gerente Manutenção):</strong> Carlos, recebemos seu ticket. A OS-127 foi criada para investigar o problema no painel e aproveitaremos a parada para realizar a inspeção periódica.</p>
                            <small class="text-muted">16/10/2025 10:45</small>
                        </div>
                        <div class="list-group-item">
                            <p class="mb-1"><strong>Carlos Pereira (Líder Produção):</strong> Obrigado, Maria. Ficamos no aguardo da programação para liberar o equipamento.</p>
                            <small class="text-muted">16/10/2025 11:00</small>
                        </div>
                     </div>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Lógica do Calendário
            var calendarEl = document.getElementById('calendar-prod');
            var calendarTab = document.getElementById('calendar-tab');
            var calendar;

            calendarTab.addEventListener('shown.bs.tab', function () {
                if (!calendar) {
                    calendar = new FullCalendar.Calendar(calendarEl, {
                        locale: 'pt-br',
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridMonth,timeGridWeek,listWeek'
                        },
                        initialView: 'dayGridMonth',
                        events: [
                            {
                                title: 'Parada: Reparo Forno F-01',
                                start: '2025-10-17',
                                allDay: true,
                                color: '#0dcaf0'
                            },
                            {
                                title: 'Parada: Troca rolamento Esteira E-22',
                                start: '2025-10-18T10:00:00',
                                end: '2025-10-18T12:00:00',
                                color: '#0d6efd'
                            },
                             {
                                title: 'Parada: Inspeção Prensa P-05',
                                start: '2025-10-20T14:00:00',
                                end: '2025-10-20T16:00:00',
                                color: '#ffc107',
                                textColor: '#000'
                            }
                        ]
                    });
                    calendar.render();
                }
            });

            // Lógica do Modal de Feedback (estrelas)
            const feedbackModal = document.getElementById('feedbackModal');
            if (feedbackModal) {
                const stars = feedbackModal.querySelectorAll('#star-rating i');
                const ratingInput = feedbackModal.querySelector('#rating-value');

                function updateStars(rating) {
                    stars.forEach(star => {
                        star.classList.toggle('bi-star-fill', star.dataset.value <= rating);
                        star.classList.toggle('bi-star', star.dataset.value > rating);
                    });
                }

                stars.forEach(star => {
                    star.addEventListener('click', () => {
                        const rating = star.dataset.value;
                        ratingInput.value = rating;
                        updateStars(rating);
                    });
                    star.addEventListener('mouseover', () => {
                        updateStars(star.dataset.value);
                    });
                });
                
                feedbackModal.querySelector('#star-rating').addEventListener('mouseleave', () => {
                    updateStars(ratingInput.value);
                });
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gerencial - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilo geral e customizações do Bootstrap */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
            transition: transform .2s ease-in-out, box-shadow .2s ease-in-out;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,.1);
        }

        .stat-card {
            color: white;
        }

        .stat-card .display-4 {
            font-weight: 700;
        }

        .stat-card i {
            font-size: 4rem;
            opacity: 0.2;
            transition: transform .3s ease;
        }

        .stat-card:hover i {
            transform: scale(1.1);
        }

        .table-hover tbody tr {
            cursor: pointer;
        }

        .badge {
            font-weight: 600;
            padding: 0.4em 0.7em;
        }
        
        /* Ajuste de cores para os status */
        .status-awaiting_approval {
            background-color: #ffc107 !important;
            color: #000 !important;
        }
        .status-open {
            background-color: #0d6efd !important;
        }
        .status-in_progress {
            background-color: #0dcaf0 !important;
            color: #000 !important;
        }
        .status-on_hold {
             background-color: #6c757d !important;
        }

        /* Ajuste de prioridade */
        .priority-1 { background-color: #dc3545 !important; } /* Alta */
        .priority-2 { background-color: #fd7e14 !important; } /* Média */
        .priority-3 { background-color: #ffc107 !important; color: #000 !important; } /* Baixa */
        
        .nav-link.active {
            font-weight: 600;
            color: #fff !important;
        }
    </style>
</head>
<body>

    <!-- Navegação Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Ordens de Serviço</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tickets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Calendário</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <a href="#" class="btn btn-primary me-3">
                        <i class="bi bi-plus-circle-fill me-1"></i> Criar Ticket
                    </a>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-4 me-2"></i>
                            <div>
                                <div class="fw-bold">Maria Almeida</div>
                                <small class="text-muted">Gerente</small>
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="dropdownUser">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person-fill me-2"></i> Perfil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear-fill me-2"></i> Configurações</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-4">
        <h1 class="h2 mb-4">Dashboard Gerencial</h1>

        <!-- Cartões de Estatísticas -->
        <div class="row g-4">
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card stat-card bg-warning">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase">OS Aguardando Aprovação</h6>
                            <p class="display-4">4</p>
                        </div>
                        <i class="bi bi-patch-question-fill"></i>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card stat-card bg-danger">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase">OS de Alta Prioridade</h6>
                            <p class="display-4">2</p>
                        </div>
                        <i class="bi bi-exclamation-triangle-fill"></i>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card stat-card bg-info">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase">OS Em Progresso</h6>
                            <p class="display-4">7</p>
                        </div>
                        <i class="bi bi-gear-wide-connected"></i>
                    </div>
                </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="card stat-card bg-primary">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase">Tickets Abertos</h6>
                            <p class="display-4">12</p>
                        </div>
                        <i class="bi bi-ticket-detailed-fill"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabelas de Dados -->
        <div class="row mt-4 g-4">
            
            <!-- Ordens de Serviço Críticas -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-list-check me-2"></i>Ordens de Serviço Críticas</h5>
                        <a href="#" class="btn btn-sm btn-outline-primary">Ver todas</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col">Título</th>
                                        <th scope="col">Ativo</th>
                                        <th scope="col">Status</th>
                                        <th scope="col">Prioridade</th>
                                        <th scope="col">Atribuído a</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados fictícios consistentes com all-models.py -->
                                    <tr>
                                        <td><strong>Verificar superaquecimento do motor</strong></td>
                                        <td>Prensa Hidráulica P-05</td>
                                        <td><span class="badge status-awaiting_approval">Aguardando Aprovação</span></td>
                                        <td><span class="badge priority-1">1</span></td>
                                        <td>Não atribuído</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Falha no sensor de pressão</strong></td>
                                        <td>Compressor de Ar C-101</td>
                                        <td><span class="badge status-in_progress">Em Progresso</span></td>
                                        <td><span class="badge priority-1">1</span></td>
                                        <td>João Silva</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Ruído incomum na esteira transportadora</strong></td>
                                        <td>Esteira E-22</td>
                                        <td><span class="badge status-open">Aberta</span></td>
                                        <td><span class="badge priority-2">2</span></td>
                                        <td>Não atribuído</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Vazamento de óleo na unidade hidráulica</strong></td>
                                        <td>Bomba Hidráulica B-52</td>
                                        <td><span class="badge status-on_hold">Em Espera</span></td>
                                        <td><span class="badge priority-2">2</span></td>
                                        <td>Carlos Pereira</td>
                                    </tr>
                                     <tr>
                                        <td><strong>Manutenção preventiva semanal</strong></td>
                                        <td>Forno Industrial F-01</td>
                                        <td><span class="badge status-open">Aberta</span></td>
                                        <td><span class="badge priority-3">3</span></td>
                                        <td>Ana Carolina Souza</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tickets Recentes -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-ticket me-2"></i>Tickets Recentes</h5>
                        <a href="#" class="btn btn-sm btn-outline-primary">Ver todos</a>
                    </div>
                    <div class="list-group list-group-flush">
                        <!-- Dados fictícios consistentes com all-models.py -->
                        <a href="#" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">Painel da IHM não responde</h6>
                                <small class="text-muted">3 min atrás</small>
                            </div>
                            <p class="mb-1 small">Solicitante: Roberto Andrade</p>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">Luz de emergência piscando</h6>
                                <small class="text-muted">25 min atrás</small>
                            </div>
                            <p class="mb-1 small">Solicitante: Lúcia Martins</p>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">Porta do almoxarifado não trava</h6>
                                <small class="text-muted">1 hora atrás</small>
                            </div>
                            <p class="mb-1 small">Solicitante: Fernando Costa</p>
                        </a>
                         <a href="#" class="list-group-item list-group-item-action text-center">
                            <strong>Ver todos os tickets</strong>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Bootstrap 5.3.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordens de Serviço - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilo geral herdado do dashboard */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        
        .table-hover tbody tr {
            cursor: pointer;
        }

        .badge {
            font-weight: 600;
            padding: 0.4em 0.7em;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
        }
        
        /* Cores consistentes para os status das Ordens de Serviço */
        /* Baseado nos STATUS_CHOICES de work_orders/models.py */
        .status-awaiting_approval { background-color: #ffc107 !important; color: #000 !important; }
        .status-open { background-color: #0d6efd !important; }
        .status-in_progress { background-color: #0dcaf0 !important; color: #000 !important; }
        .status-on_hold { background-color: #6c757d !important; }
        .status-completed { background-color: #198754 !important; }
        .status-closed { background-color: #212529 !important; }

        /* Cores consistentes para prioridade */
        .priority-1 { background-color: #dc3545 !important; } /* Alta */
        .priority-2 { background-color: #fd7e14 !important; } /* Média */
        .priority-3 { background-color: #6c757d !important; } /* Normal */
        
        .nav-link.active {
            font-weight: 600;
            color: #fff !important;
        }

        .form-control, .form-select {
            font-size: 0.9rem;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: .875rem;
        }
    </style>
</head>
<body>

    <!-- Navegação Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="dashboard.html">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Ordens de Serviço</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tickets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Calendário</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <a href="#" class="btn btn-primary me-3">
                        <i class="bi bi-plus-circle-fill me-1"></i> Criar Ticket
                    </a>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-4 me-2"></i>
                            <div>
                                <div class="fw-bold">Maria Almeida</div>
                                <small class="text-muted">Gerente</small>
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="dropdownUser">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person-fill me-2"></i> Perfil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear-fill me-2"></i> Configurações</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 mb-0">Ordens de Serviço</h1>
            <a href="#" class="btn btn-primary">
                <i class="bi bi-plus-circle-fill me-1"></i> Criar Ordem de Serviço
            </a>
        </div>

        <!-- Card de Filtros -->
        <div class="card mb-4">
            <div class="card-body">
                <form class="row g-3 align-items-end">
                    <div class="col-md-4 col-lg-5">
                        <label for="search" class="form-label">Busca Rápida</label>
                        <input type="text" class="form-control" id="search" placeholder="Buscar por título, ID do ativo...">
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <label for="statusFilter" class="form-label">Status</label>
                        <select id="statusFilter" class="form-select">
                            <option selected>Todos</option>
                            <option value="awaiting_approval">Aguardando Aprovação</option>
                            <option value="open">Aberta</option>
                            <option value="in_progress">Em Progresso</option>
                            <option value="completed">Concluída</option>
                            <option value="closed">Fechada</option>
                        </select>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <label for="priorityFilter" class="form-label">Prioridade</label>
                        <select id="priorityFilter" class="form-select">
                            <option selected>Todas</option>
                            <option value="1">1 - Alta</option>
                            <option value="2">2 - Média</option>
                            <option value="3">3 - Normal</option>
                        </select>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <label for="technicianFilter" class="form-label">Técnico</label>
                        <select id="technicianFilter" class="form-select">
                            <option selected>Todos</option>
                            <option value="1">João Silva</option>
                            <option value="2">Carlos Pereira</option>
                            <option value="3">Ana Carolina Souza</option>
                        </select>
                    </div>
                    <div class="col-md-2 col-lg-1">
                        <button type="submit" class="btn btn-secondary w-100"><i class="bi bi-funnel-fill"></i></button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabela de Ordens de Serviço -->
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Título</th>
                                <th scope="col">Ativo</th>
                                <th scope="col">Atribuído a</th>
                                <th scope="col">Status</th>
                                <th scope="col">Prioridade</th>
                                <th scope="col">Data de Criação</th>
                                <th scope="col" class="text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados Fictícios -->
                            <tr>
                                <td><strong>Verificar superaquecimento do motor</strong></td>
                                <td>Prensa Hidráulica P-05</td>
                                <td>Não atribuído</td>
                                <td><span class="badge status-awaiting_approval text-uppercase">Aguardando Aprovação</span></td>
                                <td><span class="badge priority-1">1 - Alta</span></td>
                                <td>16/10/2025 14:10</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Falha no sensor de pressão</strong></td>
                                <td>Compressor de Ar C-101</td>
                                <td>João Silva</td>
                                <td><span class="badge status-in_progress text-uppercase">Em Progresso</span></td>
                                <td><span class="badge priority-1">1 - Alta</span></td>
                                <td>16/10/2025 11:30</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Ruído incomum na esteira transportadora</strong></td>
                                <td>Esteira E-22</td>
                                <td>Não atribuído</td>
                                <td><span class="badge status-open text-uppercase">Aberta</span></td>
                                <td><span class="badge priority-2">2 - Média</span></td>
                                <td>15/10/2025 17:00</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                             <tr>
                                <td><strong>Manutenção preventiva semanal</strong></td>
                                <td>Forno Industrial F-01</td>
                                <td>Ana Carolina Souza</td>
                                <td><span class="badge status-open text-uppercase">Aberta</span></td>
                                <td><span class="badge priority-3">3 - Normal</span></td>
                                <td>15/10/2025 09:00</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Troca de filtro do sistema de ventilação</strong></td>
                                <td>Sistema de Exaustão S-03</td>
                                <td>Carlos Pereira</td>
                                <td><span class="badge status-completed text-uppercase">Concluída</span></td>
                                <td><span class="badge priority-3">3 - Normal</span></td>
                                <td>12/10/2025 10:25</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                             <tr>
                                <td><strong>Vazamento de óleo na unidade hidráulica</strong></td>
                                <td>Bomba Hidráulica B-52</td>
                                <td>Carlos Pereira</td>
                                <td><span class="badge status-on_hold text-uppercase">Em Espera</span></td>
                                <td><span class="badge priority-2">2 - Média</span></td>
                                <td>11/10/2025 15:45</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                             <tr>
                                <td><strong>Calibração de balança de precisão</strong></td>
                                <td>Balança Analítica B-01</td>
                                <td>Serviço Externo</td>
                                <td><span class="badge status-closed text-uppercase">Fechada</span></td>
                                <td><span class="badge priority-3">3 - Normal</span></td>
                                <td>01/10/2025 08:00</td>
                                <td class="text-end">
                                    <a href="#" class="btn btn-sm btn-outline-primary" title="Ver Detalhes"><i class="bi bi-eye-fill"></i></a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
             <div class="card-footer d-flex justify-content-center">
                <nav aria-label="Paginação">
                    <ul class="pagination mb-0">
                        <li class="page-item disabled"><a class="page-link" href="#">Anterior</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">Próximo</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </main>
    
    <!-- Bootstrap 5.3.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes OS: Falha no sensor - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilos herdados e específicos da página */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .badge {
            font-weight: 600;
            padding: 0.4em 0.7em;
            font-size: 0.8rem;
        }
        .nav-link.active {
            font-weight: 600;
            color: #fff !important;
        }
        .nav-tabs .nav-link {
            color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            color: #000;
            background-color: #f8f9fa;
            border-bottom: 2px solid #0d6efd;
        }
        .list-group-item strong {
            display: inline-block;
            width: 110px;
        }
        /* Cores de status e prioridade */
        .status-in_progress { background-color: #0dcaf0 !important; color: #000 !important; }
        .priority-1 { background-color: #dc3545 !important; }
    </style>
</head>
<body>

    <!-- Navegação Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="dashboard.html">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="work_orders_list.html">Ordens de Serviço</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tickets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Calendário</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                     <a href="#" class="btn btn-primary me-3"><i class="bi bi-plus-circle-fill me-1"></i> Criar Ticket</a>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-4 me-2"></i>
                            <div><div class="fw-bold">Maria Almeida</div><small class="text-muted">Gerente</small></div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="dropdownUser">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person-fill me-2"></i> Perfil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear-fill me-2"></i> Configurações</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container-fluid p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h1 class="h2 mb-0">OS: Falha no sensor de pressão</h1>
                <p class="text-muted mb-0">Ativo: Compressor de Ar C-101</p>
            </div>
            <a href="work_orders_list.html" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Voltar para a Lista
            </a>
        </div>

        <div class="row g-4">
            <!-- Coluna Direita: Informações Gerais e Ações -->
            <div class="col-lg-4 order-lg-2">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center bg-light">
                        <h5 class="mb-0">Informações Gerais</h5>
                        <span class="badge status-in_progress">Em Progresso</span>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Prioridade:</strong> <span class="badge priority-1">1 - Alta</span></li>
                        <li class="list-group-item"><strong>Atribuído a:</strong> João Silva</li>
                        <li class="list-group-item"><strong>Ativo:</strong> Compressor de Ar C-101</li>
                        <li class="list-group-item"><strong>Localização:</strong> Galpão B</li>
                        <li class="list-group-item"><strong>Ticket:</strong> <a href="#">TKT-2025-0012</a></li>
                        <li class="list-group-item"><strong>Criado em:</strong> 16/10/2025 11:30</li>
                        <li class="list-group-item"><strong>Início Real:</strong> 16/10/2025 15:30</li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-header bg-light"><h5 class="mb-0">Ações Disponíveis</h5></div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#completeWorkOrderModal">
                                <i class="bi bi-check-circle-fill me-2"></i>Concluir Trabalho
                            </button>
                            <button class="btn btn-secondary"><i class="bi bi-pause-circle-fill me-2"></i>Colocar em Espera</button>
                            <button class="btn btn-outline-danger"><i class="bi bi-x-circle-fill me-2"></i>Cancelar OS</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coluna Esquerda: Detalhes com Abas -->
            <div class="col-lg-8 order-lg-1">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="wo-tabs" role="tablist">
                            <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#details-tab-pane" type="button">Detalhes</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#parts-tab-pane" type="button">Peças Utilizadas</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#photos-tab-pane" type="button">Fotos</button></li>
                            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#history-tab-pane" type="button">Histórico</button></li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="wo-tabs-content">
                            
                            <!-- Aba de Detalhes -->
                            <div class="tab-pane fade show active" id="details-tab-pane" role="tabpanel">
                                <h5>Descrição do Problema</h5>
                                <p>O compressor C-101 está parando de forma intermitente. O painel de controle exibe o código de erro "E-45: Falha de Leitura de Pressão". Suspeita-se de falha no sensor principal de pressão de saída ou em sua fiação. A produção foi interrompida e requer atenção imediata.</p>
                                <hr>
                                <h5>Aprovações</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <div class="p-2 border rounded bg-light">
                                            <strong>Aprovação Manutenção:</strong><br>
                                            <i class="bi bi-person-check-fill text-success"></i> Maria Almeida<br>
                                            <small class="text-muted"><i class="bi bi-calendar-check"></i> 16/10/2025 14:05</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <div class="p-2 border rounded bg-light">
                                            <strong>Aprovação Produção:</strong><br>
                                            <i class="bi bi-person-check-fill text-success"></i> Ricardo Gomes<br>
                                            <small class="text-muted"><i class="bi bi-calendar-check"></i> 16/10/2025 14:20</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Aba de Peças -->
                            <div class="tab-pane fade" id="parts-tab-pane" role="tabpanel">
                                <h5>Peças Utilizadas</h5>
                                <p class="text-muted">Ainda nenhuma peça registrada para esta OS.</p>
                            </div>

                            <!-- Aba de Fotos -->
                            <div class="tab-pane fade" id="photos-tab-pane" role="tabpanel">
                                <h5>Fotos e Anexos</h5>
                                <p class="text-muted">Nenhum anexo encontrado.</p>
                                <label for="formFile" class="form-label">Carregar nova foto</label>
                                <div class="input-group">
                                    <input class="form-control" type="file" id="formFile">
                                    <button class="btn btn-outline-secondary" type="button">Enviar</button>
                                </div>
                            </div>

                            <!-- Aba de Histórico -->
                            <div class="tab-pane fade" id="history-tab-pane" role="tabpanel">
                                <h5>Histórico de Eventos da OS</h5>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><strong>16/10/2025 15:30:</strong> <span class="fw-bold text-info">Status alterado:</span> Aberta <i class="bi bi-arrow-right"></i> Em Progresso por João Silva. Início do trabalho registrado.</li>
                                    <li class="list-group-item"><strong>16/10/2025 14:21:</strong> <span class="fw-bold text-primary">Status alterado:</span> Aguardando Aprovação <i class="bi bi-arrow-right"></i> Aberta. Aprovações concluídas.</li>
                                    <li class="list-group-item"><strong>16/10/2025 14:20:</strong> <span class="fw-bold text-success">OS Aprovada</span> pela Produção (Ricardo Gomes).</li>
                                    <li class="list-group-item"><strong>16/10/2025 14:05:</strong> <span class="fw-bold text-success">OS Aprovada</span> pela Manutenção (Maria Almeida).</li>
                                    <li class="list-group-item"><strong>16/10/2025 11:35:</strong> <span class="fw-bold">Técnico Atribuído:</span> João Silva por Maria Almeida.</li>
                                    <li class="list-group-item"><strong>16/10/2025 11:30:</strong> <span class="fw-bold text-dark">OS Criada</span> com status Aguardando Aprovação.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Conclusão de OS -->
    <div class="modal fade" id="completeWorkOrderModal" tabindex="-1" aria-labelledby="completeWorkOrderModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="completeWorkOrderModalLabel">Registrar Conclusão de Serviço</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="completionForm">
                <div class="mb-3">
                    <label for="rootCause" class="form-label">Causa Raiz do Problema</label>
                    <textarea class="form-control" id="rootCause" rows="3" placeholder="Ex: Fiação do sensor de pressão estava rompida na conexão com o painel." required></textarea>
                </div>
                <div class="mb-3">
                    <label for="actionTaken" class="form-label">Ação Realizada</label>
                    <textarea class="form-control" id="actionTaken" rows="4" placeholder="Ex: Fiação foi refeita com conectores novos. Sensor foi testado e calibrado. Compressor operou por 1 hora sem falhas." required></textarea>
                </div>
                <div class="mb-3">
                    <label for="nextOsRecommendation" class="form-label">Recomendação para Próxima OS (Opcional)</label>
                    <input type="text" class="form-control" id="nextOsRecommendation" placeholder="Ex: Inspecionar fiação de todos os sensores anualmente.">
                </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" form="completionForm" class="btn btn-success"><i class="bi bi-check-all"></i> Concluir e Finalizar OS</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Bootstrap 5.3.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>


<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Novo Ticket - CMMS Pro</title>
    
    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Estilos globais e de componentes */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card {
            border: none;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,.05);
        }
        .nav-link.active {
            font-weight: 600;
            color: #fff !important;
        }
        .btn-primary {
            /* Adiciona um toque especial ao botão principal */
            box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3);
        }
    </style>
</head>
<body>

    <!-- Navegação Principal -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="dashboard.html">
                <i class="bi bi-tools me-2"></i>CMMS Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="work_orders_list.html">Ordens de Serviço</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Tickets</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Calendário</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                     <a href="ticket_create.html" class="btn btn-primary me-3 active"><i class="bi bi-plus-circle-fill me-1"></i> Criar Ticket</a>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle fs-4 me-2"></i>
                            <div><div class="fw-bold">Roberto Andrade</div><small class="text-muted">Solicitante</small></div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="dropdownUser">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person-fill me-2"></i> Perfil</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal: Formulário de Criação -->
    <main class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-light border-0 pt-3">
                        <h1 class="h3 mb-0">Abrir Solicitação de Manutenção</h1>
                        <p class="text-muted mb-0">Descreva o problema ou a necessidade com o máximo de detalhes.</p>
                    </div>
                    <div class="card-body p-4">
                        <form action="/api/tickets/" method="POST">
                            <!-- Campo: Título -->
                            <div class="mb-3">
                                <label for="ticketTitle" class="form-label fw-bold">Título</label>
                                <input type="text" class="form-control" id="ticketTitle" name="title" placeholder="Ex: Equipamento com barulho estranho na partida" required>
                                <div class="form-text">Forneça um resumo curto e claro do problema.</div>
                            </div>

                            <!-- Campo: Ativo -->
                            <div class="mb-3">
                                <label for="ticketAsset" class="form-label fw-bold">Ativo (Equipamento)</label>
                                <select class="form-select" id="ticketAsset" name="asset_id" required>
                                    <option selected disabled value="">Selecione o ativo relacionado ao problema...</option>
                                    <!-- Dados Fictícios baseados em all-models.py -> Asset -->
                                    <option value="d8b8a8e8-9b8b-4b8b-8b8b-8b8b8b8b8b8b">Prensa Hidráulica P-05</option>
                                    <option value="c7a7a7e7-8a7a-3a7a-7a7a-7a7a7a7a7a7a">Compressor de Ar C-101</option>
                                    <option value="b6b6b6e6-7b6b-2b6b-6b6b-6b6b6b6b6b6b">Esteira E-22</option>
                                    <option value="a5a5a5e5-6a5a-1a5a-5a5a-5a5a5a5a5a5a">Bomba Hidráulica B-52</option>
                                </select>
                                <div class="form-text">Se não souber ou não se aplicar, deixe em branco.</div>
                            </div>

                            <!-- Campo: Descrição -->
                            <div class="mb-4">
                                <label for="ticketDescription" class="form-label fw-bold">Descrição Detalhada</label>
                                <textarea class="form-control" id="ticketDescription" name="description" rows="6" placeholder="Forneça todos os detalhes relevantes:&#10;- O que está acontecendo?&#10;- Quando o problema começou?&#10;- Houve algum evento anterior (ex: queda de energia)?&#10;- Existe algum código de erro no painel?" required></textarea>
                            </div>

                            <hr>

                            <!-- Botões de Ação -->
                            <div class="d-flex justify-content-end">
                                <a href="dashboard.html" class="btn btn-secondary me-2">Cancelar</a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-send-fill me-2"></i>Enviar Ticket
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Bootstrap 5.3.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
